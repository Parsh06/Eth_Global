(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.ChainsafeLibp2PNoise = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var ChainsafeLibp2PNoise=(()=>{var Mn=Object.defineProperty;var vc=Object.getOwnPropertyDescriptor;var Bc=Object.getOwnPropertyNames;var _c=Object.prototype.hasOwnProperty;var bt=(e,t)=>{for(var r in t)Mn(e,r,{get:t[r],enumerable:!0})},Ic=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Bc(t))!_c.call(e,o)&&o!==r&&Mn(e,o,{get:()=>t[o],enumerable:!(n=vc(t,o))||n.enumerable});return e};var Lc=e=>Ic(Mn({},"__esModule",{value:!0}),e);var zh={};bt(zh,{noise:()=>Fh,pureJsCrypto:()=>Rn});var On=Symbol.for("@libp2p/peer-id");var Mr=class extends Error{static name="UnexpectedPeerError";constructor(t="Unexpected Peer"){super(t),this.name="UnexpectedPeerError"}},Or=class extends Error{static name="InvalidCryptoExchangeError";constructor(t="Invalid crypto exchange"){super(t),this.name="InvalidCryptoExchangeError"}},rt=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},Ke=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}};var Te=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var js=Symbol.for("@libp2p/service-capabilities"),Yh=Symbol.for("@libp2p/service-dependencies");var Fn={};bt(Fn,{base58btc:()=>et,base58flickr:()=>Pc});var gl=new Uint8Array(0);function Zs(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function Nt(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function Xs(e){return new TextEncoder().encode(e)}function Ys(e){return new TextDecoder().decode(e)}function Kc(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var s=e.charAt(o),i=s.charCodeAt(0);if(r[i]!==255)throw new TypeError(s+" is ambiguous");r[i]=o}var a=e.length,c=e.charAt(0),f=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var w=0,g=0,b=0,B=d.length;b!==B&&d[b]===0;)b++,w++;for(var E=(B-b)*l+1>>>0,U=new Uint8Array(E);b!==B;){for(var k=d[b],O=0,M=E-1;(k!==0||O<g)&&M!==-1;M--,O++)k+=256*U[M]>>>0,U[M]=k%a>>>0,k=k/a>>>0;if(k!==0)throw new Error("Non-zero carry");g=O,b++}for(var P=E-g;P!==E&&U[P]===0;)P++;for(var S=c.repeat(w);P<E;++P)S+=e.charAt(U[P]);return S}function u(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var w=0;if(d[w]!==" "){for(var g=0,b=0;d[w]===c;)g++,w++;for(var B=(d.length-w)*f+1>>>0,E=new Uint8Array(B);d[w];){var U=r[d.charCodeAt(w)];if(U===255)return;for(var k=0,O=B-1;(U!==0||k<b)&&O!==-1;O--,k++)U+=a*E[O]>>>0,E[O]=U%256>>>0,U=U/256>>>0;if(U!==0)throw new Error("Non-zero carry");b=k,w++}if(d[w]!==" "){for(var M=B-b;M!==B&&E[M]===0;)M++;for(var P=new Uint8Array(g+(B-M)),S=g;M!==B;)P[S++]=E[M++];return P}}}function p(d){var w=u(d);if(w)return w;throw new Error(`Non-${t} character`)}return{encode:h,decodeUnsafe:u,decode:p}}var Tc=Kc,Cc=Tc,Ws=Cc;var Hn=class{name;prefix;baseEncode;constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},qn=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,r,n){this.name=t,this.prefix=r;let o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Js(this,t)}},Vn=class{decoders;constructor(t){this.decoders=t}or(t){return Js(this,t)}decode(t){let r=t[0],n=this.decoders[r];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Js(e,t){return new Vn({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}var Gn=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new Hn(t,r,n),this.decoder=new qn(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function Ce({name:e,prefix:t,encode:r,decode:n}){return new Gn(e,t,r,n)}function Qt({name:e,prefix:t,alphabet:r}){let{encode:n,decode:o}=Ws(r,e);return Ce({prefix:t,name:e,encode:n,decode:s=>Nt(o(s))})}function Uc(e,t,r,n){let o=e.length;for(;e[o-1]==="=";)--o;let s=new Uint8Array(o*r/8|0),i=0,a=0,c=0;for(let f=0;f<o;++f){let l=t[e[f]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);a=a<<r|l,i+=r,i>=8&&(i-=8,s[c++]=255&a>>i)}if(i>=r||(255&a<<8-i)!==0)throw new SyntaxError("Unexpected end of data");return s}function Dc(e,t,r){let n=t[t.length-1]==="=",o=(1<<r)-1,s="",i=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],i+=8;i>r;)i-=r,s+=t[o&a>>i];if(i!==0&&(s+=t[o&a<<r-i]),n)for(;(s.length*r&7)!==0;)s+="=";return s}function Rc(e){let t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}function tt({name:e,prefix:t,bitsPerChar:r,alphabet:n}){let o=Rc(n);return Ce({prefix:t,name:e,encode(s){return Dc(s,n,r)},decode(s){return Uc(s,o,r,e)}})}var et=Qt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Pc=Qt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var zn={};bt(zn,{base32:()=>Ue,base32hex:()=>Oc,base32hexpad:()=>qc,base32hexpadupper:()=>Vc,base32hexupper:()=>Hc,base32pad:()=>kc,base32padupper:()=>Mc,base32upper:()=>Nc,base32z:()=>Gc});var Ue=tt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Nc=tt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),kc=tt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Mc=tt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Oc=tt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Hc=tt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),qc=tt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Vc=tt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Gc=tt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var jn={};bt(jn,{base36:()=>ar,base36upper:()=>Fc});var ar=Qt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Fc=Qt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var zc=ei,Qs=128,jc=127,Zc=~jc,Xc=Math.pow(2,31);function ei(e,t,r){t=t||[],r=r||0;for(var n=r;e>=Xc;)t[r++]=e&255|Qs,e/=128;for(;e&Zc;)t[r++]=e&255|Qs,e>>>=7;return t[r]=e|0,ei.bytes=r-n+1,t}var Yc=Zn,$c=128,ti=127;function Zn(e,n){var r=0,n=n||0,o=0,s=n,i,a=e.length;do{if(s>=a)throw Zn.bytes=0,new RangeError("Could not decode varint");i=e[s++],r+=o<28?(i&ti)<<o:(i&ti)*Math.pow(2,o),o+=7}while(i>=$c);return Zn.bytes=s-n,r}var Wc=Math.pow(2,7),Jc=Math.pow(2,14),Qc=Math.pow(2,21),tf=Math.pow(2,28),ef=Math.pow(2,35),rf=Math.pow(2,42),nf=Math.pow(2,49),of=Math.pow(2,56),sf=Math.pow(2,63),af=function(e){return e<Wc?1:e<Jc?2:e<Qc?3:e<tf?4:e<ef?5:e<rf?6:e<nf?7:e<of?8:e<sf?9:10},cf={encode:zc,decode:Yc,encodingLength:af},ff=cf,cr=ff;function fr(e,t=0){return[cr.decode(e,t),cr.decode.bytes]}function De(e,t,r=0){return cr.encode(e,t,r),t}function Re(e){return cr.encodingLength(e)}function Ut(e,t){let r=t.byteLength,n=Re(e),o=n+Re(r),s=new Uint8Array(o+r);return De(e,s,0),De(r,s,n),s.set(t,o),new Pe(e,r,t,s)}function Xn(e){let t=Nt(e),[r,n]=fr(t),[o,s]=fr(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new Pe(r,o,i,t)}function ri(e,t){if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&Zs(e.bytes,r.bytes)}}var Pe=class{code;size;digest;bytes;constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}};function ni(e,t){let{bytes:r,version:n}=e;switch(n){case 0:return hf(r,Yn(e),t??et.encoder);default:return lf(r,Yn(e),t??Ue.encoder)}}var oi=new WeakMap;function Yn(e){let t=oi.get(e);if(t==null){let r=new Map;return oi.set(e,r),r}return t}var ht=class e{code;version;multihash;bytes;"/";constructor(t,r,n,o){this.code=r,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==ur)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==df)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=Ut(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(t,r){let n=r;return n!=null&&t.code===n.code&&t.version===n.version&&ri(t.multihash,n.multihash)}toString(t){return ni(this,t)}toJSON(){return{"/":ni(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof e)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:s,bytes:i}=r;return new e(n,o,s,i??si(n,o,s.bytes))}else if(r[pf]===!0){let{version:n,multihash:o,code:s}=r,i=Xn(o);return e.create(n,s,i)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==ur)throw new Error(`Version 0 CID must use dag-pb (code: ${ur}) block encoding`);return new e(t,r,n,n.bytes)}case 1:{let o=si(t,r,n.bytes);return new e(t,r,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,ur,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){let[r,n]=e.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=e.inspectBytes(t),n=r.size-r.multihashSize,o=Nt(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=o.subarray(r.multihashSize-r.digestSize),i=new Pe(r.multihashCode,r.digestSize,s,o);return[r.version===0?e.createV0(i):e.createV1(r.codec,i),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[h,u]=fr(t.subarray(r));return r+=u,h},o=n(),s=ur;if(o===18?(o=0,r=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=r,a=n(),c=n(),f=r+c,l=f-i;return{version:o,codec:s,multihashCode:a,digestSize:c,multihashSize:l,size:f}}static parse(t,r){let[n,o]=uf(t,r),s=e.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Yn(s).set(n,t),s}};function uf(e,t){switch(e[0]){case"Q":{let r=t??et;return[et.prefix,r.decode(`${et.prefix}${e}`)]}case et.prefix:{let r=t??et;return[et.prefix,r.decode(e)]}case Ue.prefix:{let r=t??Ue;return[Ue.prefix,r.decode(e)]}case ar.prefix:{let r=t??ar;return[ar.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}}function hf(e,t,r){let{prefix:n}=r;if(n!==et.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=t.get(n);if(o==null){let s=r.encode(e).slice(1);return t.set(n,s),s}else return o}function lf(e,t,r){let{prefix:n}=r,o=t.get(n);if(o==null){let s=r.encode(e);return t.set(n,s),s}else return o}var ur=112,df=18;function si(e,t,r){let n=Re(e),o=n+Re(t),s=new Uint8Array(o+r.byteLength);return De(e,s,0),De(t,s,n),s.set(r,o),s}var pf=Symbol.for("@ipld/js-cid/CID");var $n={};bt($n,{identity:()=>Dt});var ii=0,yf="identity",ai=Nt;function mf(e,t){if(t?.truncate!=null&&t.truncate!==e.byteLength){if(t.truncate<0||t.truncate>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,t.truncate)}return Ut(ii,ai(e))}var Dt={code:ii,name:yf,encode:ai,digest:mf};function mt(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function nt(e=0){return new Uint8Array(e)}function ot(e=0){return new Uint8Array(e)}function le(e,t){t==null&&(t=e.reduce((o,s)=>o+s.length,0));let r=ot(t),n=0;for(let o of e)r.set(o,n),n+=o.length;return r}var fi=Symbol.for("@achingbrain/uint8arraylist");function ci(e,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let r=0;for(let n of e){let o=r+n.byteLength;if(t<o)return{buf:n,index:t-r};r=o}throw new RangeError("index is out of bounds")}function qr(e){return!!e?.[fi]}var X=class e{bufs;length;[fi]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let r=0;for(let n of t)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(qr(n))r+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}prepend(...t){this.prependAll(t)}prependAll(t){let r=0;for(let n of t.reverse())if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.unshift(n);else if(qr(n))r+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(t){let r=ci(this.bufs,t);return r.buf[r.index]}set(t,r){let n=ci(this.bufs,t);n.buf[n.index]=r}write(t,r=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(r+n,t[n]);else if(qr(t))for(let n=0;n<t.length;n++)this.set(r+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,r){let{bufs:n,length:o}=this._subList(t,r);return le(n,o)}subarray(t,r){let{bufs:n,length:o}=this._subList(t,r);return n.length===1?n[0]:le(n,o)}sublist(t,r){let{bufs:n,length:o}=this._subList(t,r),s=new e;return s.length=o,s.bufs=[...n],s}_subList(t,r){if(t=t??0,r=r??this.length,t<0&&(t=this.length+t),r<0&&(r=this.length+r),t<0||r>this.length)throw new RangeError("index is out of bounds");if(t===r)return{bufs:[],length:0};if(t===0&&r===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],a=o,c=a+i.byteLength;if(o=c,t>=c)continue;let f=t>=a&&t<c,l=r>a&&r<=c;if(f&&l){if(t===a&&r===c){n.push(i);break}let h=t-a;n.push(i.subarray(h,h+(r-t)));break}if(f){if(t===0){n.push(i);continue}n.push(i.subarray(t-a));continue}if(l){if(r===c){n.push(i);break}n.push(i.subarray(0,r-a));break}n.push(i)}return{bufs:n,length:r-t}}indexOf(t,r=0){if(!qr(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(r=Number(r??0),isNaN(r)&&(r=0),r<0&&(r=this.length+r),r<0&&(r=0),t.length===0)return r>this.length?this.length:r;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let h=0;h<s;h++)i[h]=-1;for(let h=0;h<o;h++)i[n[h]]=h;let a=i,c=this.byteLength-n.byteLength,f=n.byteLength-1,l;for(let h=r;h<=c;h+=l){l=0;for(let u=f;u>=0;u--){let p=this.get(h+u);if(n[u]!==p){l=Math.max(1,u-a[p]);break}}if(l===0)return h}return-1}getInt8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(t,r){let n=ot(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,t)}getInt16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(t,r,n){let o=nt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,r,n),this.write(o,t)}getInt32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(t,r,n){let o=nt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,r,n),this.write(o,t)}getBigInt64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(t,r,n){let o=nt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,r,n),this.write(o,t)}getUint8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(t,r){let n=ot(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,t)}getUint16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(t,r,n){let o=nt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,r,n),this.write(o,t)}getUint32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(t,r,n){let o=nt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,r,n),this.write(o,t)}getBigUint64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(t,r,n){let o=nt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,r,n),this.write(o,t)}getFloat32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(t,r,n){let o=nt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,r,n),this.write(o,t)}getFloat64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(t,r,n){let o=nt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,r,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof e)||t.bufs.length!==this.bufs.length)return!1;for(let r=0;r<this.bufs.length;r++)if(!mt(this.bufs[r],t.bufs[r]))return!1;return!0}static fromUint8Arrays(t,r){let n=new e;return n.bufs=t,r==null&&(r=t.reduce((o,s)=>o+s.byteLength,0)),n.length=r,n}};var Wn={};bt(Wn,{base10:()=>xf});var xf=Qt({prefix:"9",name:"base10",alphabet:"0123456789"});var Jn={};bt(Jn,{base16:()=>bf,base16upper:()=>wf});var bf=tt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),wf=tt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Qn={};bt(Qn,{base2:()=>Ef});var Ef=tt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var to={};bt(to,{base256emoji:()=>_f});var ui=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Sf=ui.reduce((e,t,r)=>(e[r]=t,e),[]),Af=ui.reduce((e,t,r)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return e[n]=r,e},[]);function vf(e){return e.reduce((t,r)=>(t+=Sf[r],t),"")}function Bf(e){let t=[];for(let r of e){let n=r.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${r}`);let o=Af[n];if(o==null)throw new Error(`Non-base256emoji character: ${r}`);t.push(o)}return new Uint8Array(t)}var _f=Ce({prefix:"\u{1F680}",name:"base256emoji",encode:vf,decode:Bf});var eo={};bt(eo,{base64:()=>If,base64pad:()=>Lf,base64url:()=>Kf,base64urlpad:()=>Tf});var If=tt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Lf=tt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Kf=tt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Tf=tt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var ro={};bt(ro,{base8:()=>Cf});var Cf=tt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var no={};bt(no,{identity:()=>Uf});var Uf=Ce({prefix:"\0",name:"identity",encode:e=>Ys(e),decode:e=>Xs(e)});var Ql=new TextEncoder,td=new TextDecoder;var io={};bt(io,{sha256:()=>Vr,sha512:()=>Nf});var Pf=20;function so({name:e,code:t,encode:r,minDigestLength:n,maxDigestLength:o}){return new oo(e,t,r,n,o)}var oo=class{name;code;encode;minDigestLength;maxDigestLength;constructor(t,r,n,o,s){this.name=t,this.code=r,this.encode=n,this.minDigestLength=o??Pf,this.maxDigestLength=s}digest(t,r){if(r?.truncate!=null){if(r.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&r.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(t instanceof Uint8Array){let n=this.encode(t);return n instanceof Uint8Array?hi(n,this.code,r?.truncate):n.then(o=>hi(o,this.code,r?.truncate))}else throw Error("Unknown type, must be binary type")}};function hi(e,t,r){if(r!=null&&r!==e.byteLength){if(r>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,r)}return Ut(t,e)}function di(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}var Vr=so({name:"sha2-256",code:18,encode:di("SHA-256")}),Nf=so({name:"sha2-512",code:19,encode:di("SHA-512")});var ao={...no,...Qn,...ro,...Wn,...Jn,...zn,...jn,...Fn,...eo,...to},ld={...io,...$n};function yi(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var pi=yi("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),co=yi("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=ot(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),kf={utf8:pi,"utf-8":pi,hex:ao.base16,latin1:co,ascii:co,binary:co,...ao},Gr=kf;function $(e,t="utf8"){let r=Gr[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}function z(e,t="utf8"){let r=Gr[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}var Mf=parseInt("11111",2),fo=parseInt("10000000",2),Of=parseInt("01111111",2),mi={0:hr,1:hr,2:Hf,3:Gf,4:Ff,5:Vf,6:qf,16:hr,22:hr,48:hr};function kt(e,t={offset:0}){let r=e[t.offset]&Mf;if(t.offset++,mi[r]!=null)return mi[r](e,t);throw new Error("No decoder for tag "+r)}function lr(e,t){let r=0;if((e[t.offset]&fo)===fo){let n=e[t.offset]&Of,o="0x";t.offset++;for(let s=0;s<n;s++,t.offset++)o+=e[t.offset].toString(16).padStart(2,"0");r=parseInt(o,16)}else r=e[t.offset],t.offset++;return r}function hr(e,t){lr(e,t);let r=[];for(;!(t.offset>=e.byteLength);){let n=kt(e,t);if(n===null)break;r.push(n)}return r}function Hf(e,t){let r=lr(e,t),n=t.offset,o=t.offset+r,s=[];for(let i=n;i<o;i++)i===n&&e[i]===0||s.push(e[i]);return t.offset+=r,Uint8Array.from(s)}function qf(e,t){let r=lr(e,t),n=t.offset+r,o=e[t.offset];t.offset++;let s=0,i=0;o<40?(s=0,i=o):o<80?(s=1,i=o-40):(s=2,i=o-80);let a=`${s}.${i}`,c=[];for(;t.offset<n;){let f=e[t.offset];if(t.offset++,c.push(f&127),f<128){c.reverse();let l=0;for(let h=0;h<c.length;h++)l+=c[h]<<h*7;a+=`.${l}`,c=[]}}return a}function Vf(e,t){return t.offset++,null}function Gf(e,t){let r=lr(e,t),n=e[t.offset];t.offset++;let o=e.subarray(t.offset,t.offset+r-1);if(t.offset+=r,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function Ff(e,t){let r=lr(e,t),n=e.subarray(t.offset,t.offset+r);return t.offset+=r,n}function zf(e){let t=e.toString(16);t.length%2===1&&(t="0"+t);let r=new X;for(let n=0;n<t.length;n+=2)r.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return r}function uo(e){if(e.byteLength<128)return Uint8Array.from([e.byteLength]);let t=zf(e.byteLength);return new X(Uint8Array.from([t.byteLength|fo]),t)}function wt(e){let t=new X,r=128;return(e.subarray()[0]&r)===r&&t.append(Uint8Array.from([0])),t.append(e),new X(Uint8Array.from([2]),uo(t),t)}function Fr(e){let t=Uint8Array.from([0]),r=new X(t,e);return new X(Uint8Array.from([3]),uo(r),r)}function te(e,t=48){let r=new X;for(let n of e)r.append(n);return new X(Uint8Array.from([t]),uo(r),r)}async function gi(e,t,r,n){let o=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();let s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,t,r.subarray());return n?.signal?.throwIfAborted(),s}var jf=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),Zf=Uint8Array.from([6,5,43,129,4,0,34]),Xf=Uint8Array.from([6,5,43,129,4,0,35]),Yf={ext:!0,kty:"EC",crv:"P-256"},$f={ext:!0,kty:"EC",crv:"P-384"},Wf={ext:!0,kty:"EC",crv:"P-521"},ho=32,lo=48,po=66;function xi(e){let t=kt(e);return bi(t)}function bi(e){let t=e[1][1][0],r=1,n,o;if(t.byteLength===ho*2+1)return n=z(t.subarray(r,r+ho),"base64url"),o=z(t.subarray(r+ho),"base64url"),new ke({...Yf,key_ops:["verify"],x:n,y:o});if(t.byteLength===lo*2+1)return n=z(t.subarray(r,r+lo),"base64url"),o=z(t.subarray(r+lo),"base64url"),new ke({...$f,key_ops:["verify"],x:n,y:o});if(t.byteLength===po*2+1)return n=z(t.subarray(r,r+po),"base64url"),o=z(t.subarray(r+po),"base64url"),new ke({...Wf,key_ops:["verify"],x:n,y:o});throw new rt(`coordinates were wrong length, got ${t.byteLength}, expected 65, 97 or 133`)}function wi(e){return te([wt(Uint8Array.from([1])),te([Jf(e.crv)],160),te([Fr(new X(Uint8Array.from([4]),$(e.x??"","base64url"),$(e.y??"","base64url")))],161)]).subarray()}function Jf(e){if(e==="P-256")return jf;if(e==="P-384")return Zf;if(e==="P-521")return Xf;throw new rt(`Invalid curve ${e}`)}var ke=class{type="ECDSA";jwk;_raw;constructor(t){this.jwk=t}get raw(){return this._raw==null&&(this._raw=wi(this.jwk)),this._raw}toMultihash(){return Dt.digest(ee(this))}toCID(){return ht.createV1(114,this.toMultihash())}toString(){return et.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:mt(this.raw,t.raw)}async verify(t,r,n){return gi(this.jwk,r,t,n)}};var de=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Ot(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function pe(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function lt(e,...t){if(!Ot(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function ye(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");pe(e.outputLen),pe(e.blockLen)}function Oe(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Si(e,t){lt(e);let r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Lt(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function zr(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Kt(e,t){return e<<32-t|e>>>t}var Ai=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Qf=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Bt(e){if(lt(e),Ai)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=Qf[e[r]];return t}var Mt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ei(e){if(e>=Mt._0&&e<=Mt._9)return e-Mt._0;if(e>=Mt.A&&e<=Mt.F)return e-(Mt.A-10);if(e>=Mt.a&&e<=Mt.f)return e-(Mt.a-10)}function me(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(Ai)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){let i=Ei(e.charCodeAt(s)),a=Ei(e.charCodeAt(s+1));if(i===void 0||a===void 0){let c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[o]=i*16+a}return n}function yo(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function re(e){return typeof e=="string"&&(e=yo(e)),lt(e),e}function gt(...e){let t=0;for(let n=0;n<e.length;n++){let o=e[n];lt(o),t+=o.length}let r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){let s=e[n];r.set(s,o),o+=s.length}return r}var Me=class{};function mo(e){let t=n=>e().update(re(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function ne(e=32){if(de&&typeof de.getRandomValues=="function")return de.getRandomValues(new Uint8Array(e));if(de&&typeof de.randomBytes=="function")return Uint8Array.from(de.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function tu(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),a=Number(r&s),c=n?4:0,f=n?0:4;e.setUint32(t+c,i,n),e.setUint32(t+f,a,n)}function vi(e,t,r){return e&t^~e&r}function Bi(e,t,r){return e&t^e&r^t&r}var dr=class extends Me{constructor(t,r,n,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=zr(this.buffer)}update(t){Oe(this),t=re(t),lt(t);let{view:r,buffer:n,blockLen:o}=this,s=t.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=zr(t);for(;o<=s-i;i+=o)this.process(c,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Oe(this),Si(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,Lt(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let h=i;h<o;h++)r[h]=0;tu(n,o-8,BigInt(this.length*8),s),this.process(n,0);let a=zr(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let f=c/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<f;h++)a.setUint32(4*h,l[h],s)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:a}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=a,o%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}},Ht=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var ft=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var jr=BigInt(4294967295),_i=BigInt(32);function eu(e,t=!1){return t?{h:Number(e&jr),l:Number(e>>_i&jr)}:{h:Number(e>>_i&jr)|0,l:Number(e&jr)|0}}function Ii(e,t=!1){let r=e.length,n=new Uint32Array(r),o=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:a}=eu(e[s],t);[n[s],o[s]]=[i,a]}return[n,o]}var go=(e,t,r)=>e>>>r,xo=(e,t,r)=>e<<32-r|t>>>r,ge=(e,t,r)=>e>>>r|t<<32-r,xe=(e,t,r)=>e<<32-r|t>>>r,pr=(e,t,r)=>e<<64-r|t>>>r-32,yr=(e,t,r)=>e>>>r-32|t<<64-r;function Rt(e,t,r,n){let o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:o|0}}var Li=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),Ki=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,Ti=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),Ci=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0,Ui=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),Di=(e,t,r,n,o,s)=>t+r+n+o+s+(e/2**32|0)|0;var nu=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),oe=new Uint32Array(64),Zr=class extends dr{constructor(t=32){super(64,t,8,!1),this.A=Ht[0]|0,this.B=Ht[1]|0,this.C=Ht[2]|0,this.D=Ht[3]|0,this.E=Ht[4]|0,this.F=Ht[5]|0,this.G=Ht[6]|0,this.H=Ht[7]|0}get(){let{A:t,B:r,C:n,D:o,E:s,F:i,G:a,H:c}=this;return[t,r,n,o,s,i,a,c]}set(t,r,n,o,s,i,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,r){for(let h=0;h<16;h++,r+=4)oe[h]=t.getUint32(r,!1);for(let h=16;h<64;h++){let u=oe[h-15],p=oe[h-2],d=Kt(u,7)^Kt(u,18)^u>>>3,w=Kt(p,17)^Kt(p,19)^p>>>10;oe[h]=w+oe[h-7]+d+oe[h-16]|0}let{A:n,B:o,C:s,D:i,E:a,F:c,G:f,H:l}=this;for(let h=0;h<64;h++){let u=Kt(a,6)^Kt(a,11)^Kt(a,25),p=l+u+vi(a,c,f)+nu[h]+oe[h]|0,w=(Kt(n,2)^Kt(n,13)^Kt(n,22))+Bi(n,o,s)|0;l=f,f=c,c=a,a=i+p|0,i=s,s=o,o=n,n=p+w|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,l=l+this.H|0,this.set(n,o,s,i,a,c,f,l)}roundClean(){Lt(oe)}destroy(){this.set(0,0,0,0,0,0,0,0),Lt(this.buffer)}};var Ri=Ii(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),ou=Ri[0],su=Ri[1],se=new Uint32Array(80),ie=new Uint32Array(80),bo=class extends dr{constructor(t=64){super(128,t,16,!1),this.Ah=ft[0]|0,this.Al=ft[1]|0,this.Bh=ft[2]|0,this.Bl=ft[3]|0,this.Ch=ft[4]|0,this.Cl=ft[5]|0,this.Dh=ft[6]|0,this.Dl=ft[7]|0,this.Eh=ft[8]|0,this.El=ft[9]|0,this.Fh=ft[10]|0,this.Fl=ft[11]|0,this.Gh=ft[12]|0,this.Gl=ft[13]|0,this.Hh=ft[14]|0,this.Hl=ft[15]|0}get(){let{Ah:t,Al:r,Bh:n,Bl:o,Ch:s,Cl:i,Dh:a,Dl:c,Eh:f,El:l,Fh:h,Fl:u,Gh:p,Gl:d,Hh:w,Hl:g}=this;return[t,r,n,o,s,i,a,c,f,l,h,u,p,d,w,g]}set(t,r,n,o,s,i,a,c,f,l,h,u,p,d,w,g){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=l|0,this.Fh=h|0,this.Fl=u|0,this.Gh=p|0,this.Gl=d|0,this.Hh=w|0,this.Hl=g|0}process(t,r){for(let E=0;E<16;E++,r+=4)se[E]=t.getUint32(r),ie[E]=t.getUint32(r+=4);for(let E=16;E<80;E++){let U=se[E-15]|0,k=ie[E-15]|0,O=ge(U,k,1)^ge(U,k,8)^go(U,k,7),M=xe(U,k,1)^xe(U,k,8)^xo(U,k,7),P=se[E-2]|0,S=ie[E-2]|0,K=ge(P,S,19)^pr(P,S,61)^go(P,S,6),D=xe(P,S,19)^yr(P,S,61)^xo(P,S,6),T=Ti(M,D,ie[E-7],ie[E-16]),y=Ci(T,O,K,se[E-7],se[E-16]);se[E]=y|0,ie[E]=T|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:a,Cl:c,Dh:f,Dl:l,Eh:h,El:u,Fh:p,Fl:d,Gh:w,Gl:g,Hh:b,Hl:B}=this;for(let E=0;E<80;E++){let U=ge(h,u,14)^ge(h,u,18)^pr(h,u,41),k=xe(h,u,14)^xe(h,u,18)^yr(h,u,41),O=h&p^~h&w,M=u&d^~u&g,P=Ui(B,k,M,su[E],ie[E]),S=Di(P,b,U,O,ou[E],se[E]),K=P|0,D=ge(n,o,28)^pr(n,o,34)^pr(n,o,39),T=xe(n,o,28)^yr(n,o,34)^yr(n,o,39),y=n&s^n&a^s&a,m=o&i^o&c^i&c;b=w|0,B=g|0,w=p|0,g=d|0,p=h|0,d=u|0,{h,l:u}=Rt(f|0,l|0,S|0,K|0),f=a|0,l=c|0,a=s|0,c=i|0,s=n|0,i=o|0;let x=Li(K,T,m);n=Ki(x,S,D,y),o=x|0}({h:n,l:o}=Rt(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=Rt(this.Bh|0,this.Bl|0,s|0,i|0),{h:a,l:c}=Rt(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l}=Rt(this.Dh|0,this.Dl|0,f|0,l|0),{h,l:u}=Rt(this.Eh|0,this.El|0,h|0,u|0),{h:p,l:d}=Rt(this.Fh|0,this.Fl|0,p|0,d|0),{h:w,l:g}=Rt(this.Gh|0,this.Gl|0,w|0,g|0),{h:b,l:B}=Rt(this.Hh|0,this.Hl|0,b|0,B|0),this.set(n,o,s,i,a,c,f,l,h,u,p,d,w,g,b,B)}roundClean(){Lt(se,ie)}destroy(){Lt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var Xr=mo(()=>new Zr);var Pi=mo(()=>new bo);var So=BigInt(0),Eo=BigInt(1);function qt(e,t=""){if(typeof e!="boolean"){let r=t&&`"${t}"`;throw new Error(r+"expected boolean, got type="+typeof e)}return e}function Et(e,t,r=""){let n=Ot(e),o=e?.length,s=t!==void 0;if(!n||s&&o!==t){let i=r&&`"${r}" `,a=s?` of length ${t}`:"",c=n?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+a+", got "+c)}return e}function mr(e){let t=e.toString(16);return t.length&1?"0"+t:t}function Ni(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?So:BigInt("0x"+e)}function He(e){return Ni(Bt(e))}function _t(e){return lt(e),Ni(Bt(Uint8Array.from(e).reverse()))}function Yr(e,t){return me(e.toString(16).padStart(t*2,"0"))}function gr(e,t){return Yr(e,t).reverse()}function j(e,t,r){let n;if(typeof t=="string")try{n=me(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(Ot(t))n=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");let o=n.length;if(typeof r=="number"&&o!==r)throw new Error(e+" of length "+r+" expected, got "+o);return n}function ki(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}function Ao(e){return Uint8Array.from(e)}var wo=e=>typeof e=="bigint"&&So<=e;function Mi(e,t,r){return wo(e)&&wo(t)&&wo(r)&&t<=e&&e<r}function ae(e,t,r,n){if(!Mi(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function $r(e){let t;for(t=0;e>So;e>>=Eo,t+=1);return t}var ce=e=>(Eo<<BigInt(e))-Eo;function Oi(e,t,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=p=>new Uint8Array(p),o=p=>Uint8Array.of(p),s=n(e),i=n(e),a=0,c=()=>{s.fill(1),i.fill(0),a=0},f=(...p)=>r(i,s,...p),l=(p=n(0))=>{i=f(o(0),p),s=f(),p.length!==0&&(i=f(o(1),p),s=f())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let p=0,d=[];for(;p<t;){s=f();let w=s.slice();d.push(w),p+=s.length}return gt(...d)};return(p,d)=>{c(),l(p);let w;for(;!(w=d(h()));)l();return c(),w}}function Pt(e,t,r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(o,s,i){let a=e[o];if(i&&a===void 0)return;let c=typeof a;if(c!==s||a===null)throw new Error(`param "${o}" is invalid: expected ${s}, got ${c}`)}Object.entries(t).forEach(([o,s])=>n(o,s,!1)),Object.entries(r).forEach(([o,s])=>n(o,s,!0))}var vo=()=>{throw new Error("not implemented")};function qe(e){let t=new WeakMap;return(r,...n)=>{let o=t.get(r);if(o!==void 0)return o;let s=e(r,...n);return t.set(r,s),s}}var xt=BigInt(0),it=BigInt(1),be=BigInt(2),Vi=BigInt(3),Gi=BigInt(4),Fi=BigInt(5),iu=BigInt(7),zi=BigInt(8),au=BigInt(9),ji=BigInt(16);function W(e,t){let r=e%t;return r>=xt?r:t+r}function J(e,t,r){let n=e;for(;t-- >xt;)n*=n,n%=r;return n}function Hi(e,t){if(e===xt)throw new Error("invert: expected non-zero number");if(t<=xt)throw new Error("invert: expected positive modulus, got "+t);let r=W(e,t),n=t,o=xt,s=it,i=it,a=xt;for(;r!==xt;){let f=n/r,l=n%r,h=o-i*f,u=s-a*f;n=r,r=l,o=i,s=a,i=h,a=u}if(n!==it)throw new Error("invert: does not exist");return W(o,t)}function Bo(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function Zi(e,t){let r=(e.ORDER+it)/Gi,n=e.pow(t,r);return Bo(e,n,t),n}function cu(e,t){let r=(e.ORDER-Fi)/zi,n=e.mul(t,be),o=e.pow(n,r),s=e.mul(t,o),i=e.mul(e.mul(s,be),o),a=e.mul(s,e.sub(i,e.ONE));return Bo(e,a,t),a}function fu(e){let t=St(e),r=Xi(e),n=r(t,t.neg(t.ONE)),o=r(t,n),s=r(t,t.neg(n)),i=(e+iu)/ji;return(a,c)=>{let f=a.pow(c,i),l=a.mul(f,n),h=a.mul(f,o),u=a.mul(f,s),p=a.eql(a.sqr(l),c),d=a.eql(a.sqr(h),c);f=a.cmov(f,l,p),l=a.cmov(u,h,d);let w=a.eql(a.sqr(l),c),g=a.cmov(f,l,w);return Bo(a,g,c),g}}function Xi(e){if(e<Vi)throw new Error("sqrt is not defined for small field");let t=e-it,r=0;for(;t%be===xt;)t/=be,r++;let n=be,o=St(e);for(;qi(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Zi;let s=o.pow(n,t),i=(t+it)/be;return function(c,f){if(c.is0(f))return f;if(qi(c,f)!==1)throw new Error("Cannot find square root");let l=r,h=c.mul(c.ONE,s),u=c.pow(f,t),p=c.pow(f,i);for(;!c.eql(u,c.ONE);){if(c.is0(u))return c.ZERO;let d=1,w=c.sqr(u);for(;!c.eql(w,c.ONE);)if(d++,w=c.sqr(w),d===l)throw new Error("Cannot find square root");let g=it<<BigInt(l-d-1),b=c.pow(h,g);l=d,h=c.sqr(b),u=c.mul(u,h),p=c.mul(p,b)}return p}}function uu(e){return e%Gi===Vi?Zi:e%zi===Fi?cu:e%ji===au?fu(e):Xi(e)}var Vt=(e,t)=>(W(e,t)&it)===it,hu=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function _o(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=hu.reduce((n,o)=>(n[o]="function",n),t);return Pt(e,r),e}function lu(e,t,r){if(r<xt)throw new Error("invalid exponent, negatives unsupported");if(r===xt)return e.ONE;if(r===it)return t;let n=e.ONE,o=t;for(;r>xt;)r&it&&(n=e.mul(n,o)),o=e.sqr(o),r>>=it;return n}function xr(e,t,r=!1){let n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce((i,a,c)=>e.is0(a)?i:(n[c]=i,e.mul(i,a)),e.ONE),s=e.inv(o);return t.reduceRight((i,a,c)=>e.is0(a)?i:(n[c]=e.mul(i,n[c]),e.mul(i,a)),s),n}function qi(e,t){let r=(e.ORDER-it)/be,n=e.pow(t,r),o=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),i=e.eql(n,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function Wr(e,t){t!==void 0&&pe(t);let r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function St(e,t,r=!1,n={}){if(e<=xt)throw new Error("invalid field: expected ORDER > 0, got "+e);let o,s,i=!1,a;if(typeof t=="object"&&t!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");let u=t;u.BITS&&(o=u.BITS),u.sqrt&&(s=u.sqrt),typeof u.isLE=="boolean"&&(r=u.isLE),typeof u.modFromBytes=="boolean"&&(i=u.modFromBytes),a=u.allowedLengths}else typeof t=="number"&&(o=t),n.sqrt&&(s=n.sqrt);let{nBitLength:c,nByteLength:f}=Wr(e,o);if(f>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l,h=Object.freeze({ORDER:e,isLE:r,BITS:c,BYTES:f,MASK:ce(c),ZERO:xt,ONE:it,allowedLengths:a,create:u=>W(u,e),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return xt<=u&&u<e},is0:u=>u===xt,isValidNot0:u=>!h.is0(u)&&h.isValid(u),isOdd:u=>(u&it)===it,neg:u=>W(-u,e),eql:(u,p)=>u===p,sqr:u=>W(u*u,e),add:(u,p)=>W(u+p,e),sub:(u,p)=>W(u-p,e),mul:(u,p)=>W(u*p,e),pow:(u,p)=>lu(h,u,p),div:(u,p)=>W(u*Hi(p,e),e),sqrN:u=>u*u,addN:(u,p)=>u+p,subN:(u,p)=>u-p,mulN:(u,p)=>u*p,inv:u=>Hi(u,e),sqrt:s||(u=>(l||(l=uu(e)),l(h,u))),toBytes:u=>r?gr(u,f):Yr(u,f),fromBytes:(u,p=!0)=>{if(a){if(!a.includes(u.length)||u.length>f)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+u.length);let w=new Uint8Array(f);w.set(u,r?0:w.length-u.length),u=w}if(u.length!==f)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+u.length);let d=r?_t(u):He(u);if(i&&(d=W(d,e)),!p&&!h.isValid(d))throw new Error("invalid field element: outside of range 0..ORDER");return d},invertBatch:u=>xr(h,u),cmov:(u,p,d)=>d?p:u});return Object.freeze(h)}function Yi(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function Io(e){let t=Yi(e);return t+Math.ceil(t/2)}function Lo(e,t,r=!1){let n=e.length,o=Yi(t),s=Io(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=r?_t(e):He(e),a=W(i,t-it)+it;return r?gr(a,o):Yr(a,o)}var Ve=BigInt(0),we=BigInt(1);function br(e,t){let r=t.negate();return e?r:t}function Gt(e,t){let r=xr(e.Fp,t.map(n=>n.Z));return t.map((n,o)=>e.fromAffine(n.toAffine(r[o])))}function Qi(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Ko(e,t){Qi(e,t);let r=Math.ceil(t/e)+1,n=2**(e-1),o=2**e,s=ce(e),i=BigInt(e);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function $i(e,t,r){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r,a=Number(e&o),c=e>>i;a>n&&(a-=s,c+=we);let f=t*n,l=f+Math.abs(a)-1,h=a===0,u=a<0,p=t%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:u,isNegF:p,offsetF:f}}function du(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((r,n)=>{if(!(r instanceof t))throw new Error("invalid point at index "+n)})}function pu(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((r,n)=>{if(!t.isValid(r))throw new Error("invalid scalar at index "+n)})}var To=new WeakMap,ta=new WeakMap;function Co(e){return ta.get(e)||1}function Wi(e){if(e!==Ve)throw new Error("invalid wNAF")}var Ge=class{constructor(t,r){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=r}_unsafeLadder(t,r,n=this.ZERO){let o=t;for(;r>Ve;)r&we&&(n=n.add(o)),o=o.double(),r>>=we;return n}precomputeWindow(t,r){let{windows:n,windowSize:o}=Ko(r,this.bits),s=[],i=t,a=i;for(let c=0;c<n;c++){a=i,s.push(a);for(let f=1;f<o;f++)a=a.add(i),s.push(a);i=a.double()}return s}wNAF(t,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=Ko(t,this.bits);for(let a=0;a<i.windows;a++){let{nextN:c,offset:f,isZero:l,isNeg:h,isNegF:u,offsetF:p}=$i(n,a,i);n=c,l?s=s.add(br(u,r[p])):o=o.add(br(h,r[f]))}return Wi(n),{p:o,f:s}}wNAFUnsafe(t,r,n,o=this.ZERO){let s=Ko(t,this.bits);for(let i=0;i<s.windows&&n!==Ve;i++){let{nextN:a,offset:c,isZero:f,isNeg:l}=$i(n,i,s);if(n=a,!f){let h=r[c];o=o.add(l?h.negate():h)}}return Wi(n),o}getPrecomputes(t,r,n){let o=To.get(r);return o||(o=this.precomputeWindow(r,t),t!==1&&(typeof n=="function"&&(o=n(o)),To.set(r,o))),o}cached(t,r,n){let o=Co(t);return this.wNAF(o,this.getPrecomputes(o,t,n),r)}unsafe(t,r,n,o){let s=Co(t);return s===1?this._unsafeLadder(t,r,o):this.wNAFUnsafe(s,this.getPrecomputes(s,t,n),r,o)}createCache(t,r){Qi(r,this.bits),ta.set(t,r),To.delete(t)}hasCache(t){return Co(t)!==1}};function ea(e,t,r,n){let o=t,s=e.ZERO,i=e.ZERO;for(;r>Ve||n>Ve;)r&we&&(s=s.add(o)),n&we&&(i=i.add(o)),o=o.double(),r>>=we,n>>=we;return{p1:s,p2:i}}function Fe(e,t,r,n){du(r,e),pu(n,t);let o=r.length,s=n.length;if(o!==s)throw new Error("arrays of points and scalars must have equal length");let i=e.ZERO,a=$r(BigInt(o)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let f=ce(c),l=new Array(Number(f)+1).fill(i),h=Math.floor((t.BITS-1)/c)*c,u=i;for(let p=h;p>=0;p-=c){l.fill(i);for(let w=0;w<s;w++){let g=n[w],b=Number(g>>BigInt(p)&f);l[b]=l[b].add(r[w])}let d=i;for(let w=l.length-1,g=i;w>0;w--)g=g.add(l[w]),d=d.add(g);if(u=u.add(d),p!==0)for(let w=0;w<c;w++)u=u.double()}return u}function Ji(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return _o(t),t}else return St(e,{isLE:r})}function Jr(e,t,r={},n){if(n===void 0&&(n=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let c of["p","n","h"]){let f=t[c];if(!(typeof f=="bigint"&&f>Ve))throw new Error(`CURVE.${c} must be positive bigint`)}let o=Ji(t.p,r.Fp,n),s=Ji(t.n,r.Fn,n),a=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let c of a)if(!o.isValid(t[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:s}}var fe=BigInt(0),at=BigInt(1),Uo=BigInt(2),yu=BigInt(8);function mu(e,t,r,n){let o=e.sqr(r),s=e.sqr(n),i=e.add(e.mul(t.a,o),s),a=e.add(e.ONE,e.mul(t.d,e.mul(o,s)));return e.eql(i,a)}function gu(e,t={}){let r=Jr("edwards",e,t,t.FpFnLE),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i}=s;Pt(t,{},{uvRatio:"function"});let a=Uo<<BigInt(o.BYTES*8)-at,c=g=>n.create(g),f=t.uvRatio||((g,b)=>{try{return{isValid:!0,value:n.sqrt(n.div(g,b))}}catch{return{isValid:!1,value:fe}}});if(!mu(n,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function l(g,b,B=!1){let E=B?at:fe;return ae("coordinate "+g,b,E,a),b}function h(g){if(!(g instanceof d))throw new Error("ExtendedPoint expected")}let u=qe((g,b)=>{let{X:B,Y:E,Z:U}=g,k=g.is0();b==null&&(b=k?yu:n.inv(U));let O=c(B*b),M=c(E*b),P=n.mul(U,b);if(k)return{x:fe,y:at};if(P!==at)throw new Error("invZ was invalid");return{x:O,y:M}}),p=qe(g=>{let{a:b,d:B}=s;if(g.is0())throw new Error("bad point: ZERO");let{X:E,Y:U,Z:k,T:O}=g,M=c(E*E),P=c(U*U),S=c(k*k),K=c(S*S),D=c(M*b),T=c(S*c(D+P)),y=c(K+c(B*c(M*P)));if(T!==y)throw new Error("bad point: equation left != right (1)");let m=c(E*U),x=c(k*O);if(m!==x)throw new Error("bad point: equation left != right (2)");return!0});class d{constructor(b,B,E,U){this.X=l("x",b),this.Y=l("y",B),this.Z=l("z",E,!0),this.T=l("t",U),Object.freeze(this)}static CURVE(){return s}static fromAffine(b){if(b instanceof d)throw new Error("extended point not allowed");let{x:B,y:E}=b||{};return l("x",B),l("y",E),new d(B,E,at,c(B*E))}static fromBytes(b,B=!1){let E=n.BYTES,{a:U,d:k}=s;b=Ao(Et(b,E,"point")),qt(B,"zip215");let O=Ao(b),M=b[E-1];O[E-1]=M&-129;let P=_t(O),S=B?a:n.ORDER;ae("point.y",P,fe,S);let K=c(P*P),D=c(K-at),T=c(k*K-U),{isValid:y,value:m}=f(D,T);if(!y)throw new Error("bad point: invalid y coordinate");let x=(m&at)===at,v=(M&128)!==0;if(!B&&m===fe&&v)throw new Error("bad point: x=0 and x_0=1");return v!==x&&(m=c(-m)),d.fromAffine({x:m,y:P})}static fromHex(b,B=!1){return d.fromBytes(j("point",b),B)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(b=8,B=!0){return w.createCache(this,b),B||this.multiply(Uo),this}assertValidity(){p(this)}equals(b){h(b);let{X:B,Y:E,Z:U}=this,{X:k,Y:O,Z:M}=b,P=c(B*M),S=c(k*U),K=c(E*M),D=c(O*U);return P===S&&K===D}is0(){return this.equals(d.ZERO)}negate(){return new d(c(-this.X),this.Y,this.Z,c(-this.T))}double(){let{a:b}=s,{X:B,Y:E,Z:U}=this,k=c(B*B),O=c(E*E),M=c(Uo*c(U*U)),P=c(b*k),S=B+E,K=c(c(S*S)-k-O),D=P+O,T=D-M,y=P-O,m=c(K*T),x=c(D*y),v=c(K*y),_=c(T*D);return new d(m,x,_,v)}add(b){h(b);let{a:B,d:E}=s,{X:U,Y:k,Z:O,T:M}=this,{X:P,Y:S,Z:K,T:D}=b,T=c(U*P),y=c(k*S),m=c(M*E*D),x=c(O*K),v=c((U+k)*(P+S)-T-y),_=x-m,L=x+m,A=c(y-B*T),I=c(v*_),C=c(L*A),R=c(v*A),q=c(_*L);return new d(I,C,q,R)}subtract(b){return this.add(b.negate())}multiply(b){if(!o.isValidNot0(b))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:B,f:E}=w.cached(this,b,U=>Gt(d,U));return Gt(d,[B,E])[0]}multiplyUnsafe(b,B=d.ZERO){if(!o.isValid(b))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return b===fe?d.ZERO:this.is0()||b===at?this:w.unsafe(this,b,E=>Gt(d,E),B)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return w.unsafe(this,s.n).is0()}toAffine(b){return u(this,b)}clearCofactor(){return i===at?this:this.multiplyUnsafe(i)}toBytes(){let{x:b,y:B}=this.toAffine(),E=n.toBytes(B);return E[E.length-1]|=b&at?128:0,E}toHex(){return Bt(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(b){return Gt(d,b)}static msm(b,B){return Fe(d,o,b,B)}_setWindowSize(b){this.precompute(b)}toRawBytes(){return this.toBytes()}}d.BASE=new d(s.Gx,s.Gy,at,c(s.Gx*s.Gy)),d.ZERO=new d(fe,at,at,fe),d.Fp=n,d.Fn=o;let w=new Ge(d,o.BITS);return d.BASE.precompute(8),d}var Qr=class{constructor(t){this.ep=t}static fromBytes(t){vo()}static fromHex(t){vo()}get x(){return this.toAffine().x}get y(){return this.toAffine().y}clearCofactor(){return this}assertValidity(){this.ep.assertValidity()}toAffine(t){return this.ep.toAffine(t)}toHex(){return Bt(this.toBytes())}toString(){return this.toHex()}isTorsionFree(){return!0}isSmallOrder(){return!1}add(t){return this.assertSame(t),this.init(this.ep.add(t.ep))}subtract(t){return this.assertSame(t),this.init(this.ep.subtract(t.ep))}multiply(t){return this.init(this.ep.multiply(t))}multiplyUnsafe(t){return this.init(this.ep.multiplyUnsafe(t))}double(){return this.init(this.ep.double())}negate(){return this.init(this.ep.negate())}precompute(t,r){return this.init(this.ep.precompute(t,r))}toRawBytes(){return this.toBytes()}};function xu(e,t,r={}){if(typeof t!="function")throw new Error('"hash" function param is required');Pt(r,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:n}=r,{BASE:o,Fp:s,Fn:i}=e,a=r.randomBytes||ne,c=r.adjustScalarBytes||(S=>S),f=r.domain||((S,K,D)=>{if(qt(D,"phflag"),K.length||D)throw new Error("Contexts/pre-hash are not supported");return S});function l(S){return i.create(_t(S))}function h(S){let K=E.secretKey;S=j("private key",S,K);let D=j("hashed private key",t(S),2*K),T=c(D.slice(0,K)),y=D.slice(K,2*K),m=l(T);return{head:T,prefix:y,scalar:m}}function u(S){let{head:K,prefix:D,scalar:T}=h(S),y=o.multiply(T),m=y.toBytes();return{head:K,prefix:D,scalar:T,point:y,pointBytes:m}}function p(S){return u(S).pointBytes}function d(S=Uint8Array.of(),...K){let D=gt(...K);return l(t(f(D,j("context",S),!!n)))}function w(S,K,D={}){S=j("message",S),n&&(S=n(S));let{prefix:T,scalar:y,pointBytes:m}=u(K),x=d(D.context,T,S),v=o.multiply(x).toBytes(),_=d(D.context,v,m,S),L=i.create(x+_*y);if(!i.isValid(L))throw new Error("sign failed: invalid s");let A=gt(v,i.toBytes(L));return Et(A,E.signature,"result")}let g={zip215:!0};function b(S,K,D,T=g){let{context:y,zip215:m}=T,x=E.signature;S=j("signature",S,x),K=j("message",K),D=j("publicKey",D,E.publicKey),m!==void 0&&qt(m,"zip215"),n&&(K=n(K));let v=x/2,_=S.subarray(0,v),L=_t(S.subarray(v,x)),A,I,C;try{A=e.fromBytes(D,m),I=e.fromBytes(_,m),C=o.multiplyUnsafe(L)}catch{return!1}if(!m&&A.isSmallOrder())return!1;let R=d(y,I.toBytes(),A.toBytes(),K);return I.add(A.multiplyUnsafe(R)).subtract(C).clearCofactor().is0()}let B=s.BYTES,E={secretKey:B,publicKey:B,signature:2*B,seed:B};function U(S=a(E.seed)){return Et(S,E.seed,"seed")}function k(S){let K=P.randomSecretKey(S);return{secretKey:K,publicKey:p(K)}}function O(S){return Ot(S)&&S.length===i.BYTES}function M(S,K){try{return!!e.fromBytes(S,K)}catch{return!1}}let P={getExtendedPublicKey:u,randomSecretKey:U,isValidSecretKey:O,isValidPublicKey:M,toMontgomery(S){let{y:K}=e.fromBytes(S),D=E.publicKey,T=D===32;if(!T&&D!==57)throw new Error("only defined for 25519 and 448");let y=T?s.div(at+K,at-K):s.div(K-at,K+at);return s.toBytes(y)},toMontgomerySecret(S){let K=E.secretKey;Et(S,K);let D=t(S.subarray(0,K));return c(D).subarray(0,K)},randomPrivateKey:U,precompute(S=8,K=e.BASE){return K.precompute(S,!1)}};return Object.freeze({keygen:k,getPublicKey:p,sign:w,verify:b,utils:P,Point:e,lengths:E})}function bu(e){let t={a:e.a,d:e.d,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,n=St(t.n,e.nBitLength,!0),o={Fp:r,Fn:n,uvRatio:e.uvRatio},s={randomBytes:e.randomBytes,adjustScalarBytes:e.adjustScalarBytes,domain:e.domain,prehash:e.prehash,mapToCurve:e.mapToCurve};return{CURVE:t,curveOpts:o,hash:e.hash,eddsaOpts:s}}function wu(e,t){let r=t.Point;return Object.assign({},t,{ExtendedPoint:r,CURVE:e,nBitLength:r.Fn.BITS,nByteLength:r.Fn.BYTES})}function ra(e){let{CURVE:t,curveOpts:r,hash:n,eddsaOpts:o}=bu(e),s=gu(t,r),i=xu(s,n,o);return wu(e,i)}var wr=BigInt(0),ze=BigInt(1),tn=BigInt(2);function Eu(e){return Pt(e,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...e})}function na(e){let t=Eu(e),{P:r,type:n,adjustScalarBytes:o,powPminus2:s,randomBytes:i}=t,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");let c=i||ne,f=a?255:448,l=a?32:56,h=BigInt(a?9:5),u=BigInt(a?121665:39081),p=a?tn**BigInt(254):tn**BigInt(447),d=a?BigInt(8)*tn**BigInt(251)-ze:BigInt(4)*tn**BigInt(445)-ze,w=p+d+ze,g=y=>W(y,r),b=B(h);function B(y){return gr(g(y),l)}function E(y){let m=j("u coordinate",y,l);return a&&(m[31]&=127),g(_t(m))}function U(y){return _t(o(j("scalar",y,l)))}function k(y,m){let x=P(E(m),U(y));if(x===wr)throw new Error("invalid private or public key received");return B(x)}function O(y){return k(y,b)}function M(y,m,x){let v=g(y*(m-x));return m=g(m-v),x=g(x+v),{x_2:m,x_3:x}}function P(y,m){ae("u",y,wr,r),ae("scalar",m,p,w);let x=m,v=y,_=ze,L=wr,A=y,I=ze,C=wr;for(let q=BigInt(f-1);q>=wr;q--){let V=x>>q&ze;C^=V,{x_2:_,x_3:A}=M(C,_,A),{x_2:L,x_3:I}=M(C,L,I),C=V;let H=_+L,G=g(H*H),Z=_-L,Q=g(Z*Z),F=G-Q,st=A+I,Le=A-I,sr=g(Le*H),ir=g(st*Z),Fs=sr+ir,zs=sr-ir;A=g(Fs*Fs),I=g(v*g(zs*zs)),_=g(G*Q),L=g(F*(G+g(u*F)))}({x_2:_,x_3:A}=M(C,_,A)),{x_2:L,x_3:I}=M(C,L,I);let R=s(L);return g(_*R)}let S={secretKey:l,publicKey:l,seed:l},K=(y=c(l))=>(lt(y,S.seed),y);function D(y){let m=K(y);return{secretKey:m,publicKey:O(m)}}return{keygen:D,getSharedSecret:(y,m)=>k(y,m),getPublicKey:y=>O(y),scalarMult:k,scalarMultBase:O,utils:{randomSecretKey:K,randomPrivateKey:K},GuBytes:b.slice(),lengths:S}}var Su=BigInt(0),zt=BigInt(1),oa=BigInt(2),Au=BigInt(3),vu=BigInt(5),Bu=BigInt(8),je=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Er={p:je,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Bu,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function aa(e){let t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),s=je,a=e*e%s*e%s,c=J(a,oa,s)*a%s,f=J(c,zt,s)*e%s,l=J(f,vu,s)*f%s,h=J(l,t,s)*l%s,u=J(h,r,s)*h%s,p=J(u,n,s)*u%s,d=J(p,o,s)*p%s,w=J(d,o,s)*p%s,g=J(w,t,s)*l%s;return{pow_p_5_8:J(g,oa,s)*e%s,b2:a}}function ca(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var Do=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function No(e,t){let r=je,n=W(t*t*t,r),o=W(n*n*t,r),s=aa(e*o).pow_p_5_8,i=W(e*n*s,r),a=W(t*i*i,r),c=i,f=W(i*Do,r),l=a===e,h=a===W(-e,r),u=a===W(-e*Do,r);return l&&(i=c),(h||u)&&(i=f),Vt(i,r)&&(i=W(-i,r)),{isValid:l||h,value:i}}var Ft=St(Er.p,{isLE:!0}),_u=St(Er.n,{isLE:!0}),Iu={...Er,Fp:Ft,hash:Pi,adjustScalarBytes:ca,uvRatio:No},jt=ra(Iu);var Sr=(()=>{let e=Ft.ORDER;return na({P:e,type:"x25519",powPminus2:t=>{let{pow_p_5_8:r,b2:n}=aa(t);return W(J(r,Au,e)*n,e)},adjustScalarBytes:ca})})();var Ro=Do,Lu=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Ku=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Tu=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Cu=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),sa=e=>No(zt,e),Uu=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Po=e=>jt.Point.Fp.create(_t(e)&Uu);function ia(e){let{d:t}=Er,r=je,n=b=>Ft.create(b),o=n(Ro*e*e),s=n((o+zt)*Tu),i=BigInt(-1),a=n((i-t*o)*n(o+t)),{isValid:c,value:f}=No(s,a),l=n(f*e);Vt(l,r)||(l=n(-l)),c||(f=l),c||(i=o);let h=n(i*(o-zt)*Cu-a),u=f*f,p=n((f+f)*a),d=n(h*Lu),w=n(zt-u),g=n(zt+u);return new jt.Point(n(p*g),n(w*d),n(d*g),n(p*w))}function Du(e){lt(e,64);let t=Po(e.subarray(0,32)),r=ia(t),n=Po(e.subarray(32,64)),o=ia(n);return new Zt(r.add(o))}var Zt=class e extends Qr{constructor(t){super(t)}static fromAffine(t){return new e(jt.Point.fromAffine(t))}assertSame(t){if(!(t instanceof e))throw new Error("RistrettoPoint expected")}init(t){return new e(t)}static hashToCurve(t){return Du(j("ristrettoHash",t,64))}static fromBytes(t){lt(t,32);let{a:r,d:n}=Er,o=je,s=U=>Ft.create(U),i=Po(t);if(!ki(Ft.toBytes(i),t)||Vt(i,o))throw new Error("invalid ristretto255 encoding 1");let a=s(i*i),c=s(zt+r*a),f=s(zt-r*a),l=s(c*c),h=s(f*f),u=s(r*n*l-h),{isValid:p,value:d}=sa(s(u*h)),w=s(d*f),g=s(d*w*u),b=s((i+i)*w);Vt(b,o)&&(b=s(-b));let B=s(c*g),E=s(b*B);if(!p||Vt(E,o)||B===Su)throw new Error("invalid ristretto255 encoding 2");return new e(new jt.Point(b,B,zt,E))}static fromHex(t){return e.fromBytes(j("ristrettoHex",t,32))}static msm(t,r){return Fe(e,jt.Point.Fn,t,r)}toBytes(){let{X:t,Y:r,Z:n,T:o}=this.ep,s=je,i=g=>Ft.create(g),a=i(i(n+r)*i(n-r)),c=i(t*r),f=i(c*c),{value:l}=sa(i(a*f)),h=i(l*a),u=i(l*c),p=i(h*u*o),d;if(Vt(o*p,s)){let g=i(r*Ro),b=i(t*Ro);t=g,r=b,d=i(h*Ku)}else d=u;Vt(t*p,s)&&(r=i(-r));let w=i((n-r)*d);return Vt(w,s)&&(w=i(-w)),Ft.toBytes(w)}equals(t){this.assertSame(t);let{X:r,Y:n}=this.ep,{X:o,Y:s}=t.ep,i=f=>Ft.create(f),a=i(r*s)===i(n*o),c=i(n*s)===i(r*o);return a||c}is0(){return this.equals(e.ZERO)}};Zt.BASE=new Zt(jt.Point.BASE);Zt.ZERO=new Zt(jt.Point.ZERO);Zt.Fp=Ft;Zt.Fn=_u;var Ar=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},en=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var fa={get(e=globalThis){let t=e.crypto;if(t?.subtle==null)throw new en("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var It=fa;var rn=32;var ko,Ru=(async()=>{try{return await It.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();async function Pu(e,t,r){if(e.buffer instanceof ArrayBuffer){let n=await It.get().subtle.importKey("raw",e.buffer,{name:"Ed25519"},!1,["verify"]);return await It.get().subtle.verify({name:"Ed25519"},n,t,r instanceof Uint8Array?r:r.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function Nu(e,t,r){return jt.verify(t,r instanceof Uint8Array?r:r.subarray(),e)}async function ua(e,t,r){return ko==null&&(ko=await Ru),ko?Pu(e,t,r):Nu(e,t,r)}function nn(e){return e==null?!1:typeof e.then=="function"&&typeof e.catch=="function"&&typeof e.finally=="function"}var on=class{type="Ed25519";raw;constructor(t){this.raw=Mo(t,rn)}toMultihash(){return Dt.digest(ee(this))}toCID(){return ht.createV1(114,this.toMultihash())}toString(){return et.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:mt(this.raw,t.raw)}verify(t,r,n){n?.signal?.throwIfAborted();let o=ua(this.raw,r,t);return nn(o)?o.then(s=>(n?.signal?.throwIfAborted(),s)):o}};function la(e){return e=Mo(e,rn),new on(e)}function Mo(e,t){if(e=Uint8Array.from(e??[]),e.length!==t)throw new rt(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}var Mu=Math.pow(2,7),Ou=Math.pow(2,14),Hu=Math.pow(2,21),Oo=Math.pow(2,28),Ho=Math.pow(2,35),qo=Math.pow(2,42),Vo=Math.pow(2,49),Y=128,dt=127;function At(e){if(e<Mu)return 1;if(e<Ou)return 2;if(e<Hu)return 3;if(e<Oo)return 4;if(e<Ho)return 5;if(e<qo)return 6;if(e<Vo)return 7;if(Number.MAX_SAFE_INTEGER!=null&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Go(e,t,r=0){switch(At(e)){case 8:t[r++]=e&255|Y,e/=128;case 7:t[r++]=e&255|Y,e/=128;case 6:t[r++]=e&255|Y,e/=128;case 5:t[r++]=e&255|Y,e/=128;case 4:t[r++]=e&255|Y,e>>>=7;case 3:t[r++]=e&255|Y,e>>>=7;case 2:t[r++]=e&255|Y,e>>>=7;case 1:{t[r++]=e&255,e>>>=7;break}default:throw new Error("unreachable")}return t}function qu(e,t,r=0){switch(At(e)){case 8:t.set(r++,e&255|Y),e/=128;case 7:t.set(r++,e&255|Y),e/=128;case 6:t.set(r++,e&255|Y),e/=128;case 5:t.set(r++,e&255|Y),e/=128;case 4:t.set(r++,e&255|Y),e>>>=7;case 3:t.set(r++,e&255|Y),e>>>=7;case 2:t.set(r++,e&255|Y),e>>>=7;case 1:{t.set(r++,e&255),e>>>=7;break}default:throw new Error("unreachable")}return t}function Fo(e,t){let r=e[t],n=0;if(n+=r&dt,r<Y||(r=e[t+1],n+=(r&dt)<<7,r<Y)||(r=e[t+2],n+=(r&dt)<<14,r<Y)||(r=e[t+3],n+=(r&dt)<<21,r<Y)||(r=e[t+4],n+=(r&dt)*Oo,r<Y)||(r=e[t+5],n+=(r&dt)*Ho,r<Y)||(r=e[t+6],n+=(r&dt)*qo,r<Y)||(r=e[t+7],n+=(r&dt)*Vo,r<Y))return n;throw new RangeError("Could not decode varint")}function Vu(e,t){let r=e.get(t),n=0;if(n+=r&dt,r<Y||(r=e.get(t+1),n+=(r&dt)<<7,r<Y)||(r=e.get(t+2),n+=(r&dt)<<14,r<Y)||(r=e.get(t+3),n+=(r&dt)<<21,r<Y)||(r=e.get(t+4),n+=(r&dt)*Oo,r<Y)||(r=e.get(t+5),n+=(r&dt)*Ho,r<Y)||(r=e.get(t+6),n+=(r&dt)*qo,r<Y)||(r=e.get(t+7),n+=(r&dt)*Vo,r<Y))return n;throw new RangeError("Could not decode varint")}function sn(e,t,r=0){return t==null&&(t=ot(At(e))),t instanceof Uint8Array?Go(e,t,r):qu(e,t,r)}function an(e,t=0){return e instanceof Uint8Array?Fo(e,t):Vu(e,t)}var jo=new Float32Array([-0]),ue=new Uint8Array(jo.buffer);function da(e,t,r){jo[0]=e,t[r]=ue[0],t[r+1]=ue[1],t[r+2]=ue[2],t[r+3]=ue[3]}function pa(e,t){return ue[0]=e[t],ue[1]=e[t+1],ue[2]=e[t+2],ue[3]=e[t+3],jo[0]}var Zo=new Float64Array([-0]),pt=new Uint8Array(Zo.buffer);function ya(e,t,r){Zo[0]=e,t[r]=pt[0],t[r+1]=pt[1],t[r+2]=pt[2],t[r+3]=pt[3],t[r+4]=pt[4],t[r+5]=pt[5],t[r+6]=pt[6],t[r+7]=pt[7]}function ma(e,t){return pt[0]=e[t],pt[1]=e[t+1],pt[2]=e[t+2],pt[3]=e[t+3],pt[4]=e[t+4],pt[5]=e[t+5],pt[6]=e[t+6],pt[7]=e[t+7],Zo[0]}var Gu=BigInt(Number.MAX_SAFE_INTEGER),Fu=BigInt(Number.MIN_SAFE_INTEGER),vt=class e{lo;hi;constructor(t,r){this.lo=t|0,this.hi=r|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?t<16384?t<128?1:2:t<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return Ee;if(t<Gu&&t>Fu)return this.fromNumber(Number(t));let r=t<0n;r&&(t=-t);let n=t>>32n,o=t-(n<<32n);return r&&(n=~n|0n,o=~o|0n,++o>ga&&(o=0n,++n>ga&&(n=0n))),new e(Number(o),Number(n))}static fromNumber(t){if(t===0)return Ee;let r=t<0;r&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return r&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new e(n,o)}static from(t){return typeof t=="number"?e.fromNumber(t):typeof t=="bigint"?e.fromBigInt(t):typeof t=="string"?e.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new e(t.low>>>0,t.high>>>0):Ee}},Ee=new vt(0,0);Ee.toBigInt=function(){return 0n};Ee.zzEncode=Ee.zzDecode=function(){return this};Ee.length=function(){return 1};var ga=4294967296n;function xa(e){let t=0,r=0;for(let n=0;n<e.length;++n)r=e.charCodeAt(n),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function ba(e,t,r){if(r-t<1)return"";let o,s=[],i=0,a;for(;t<r;)a=e[t++],a<128?s[i++]=a:a>191&&a<224?s[i++]=(a&31)<<6|e[t++]&63:a>239&&a<365?(a=((a&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,s[i++]=55296+(a>>10),s[i++]=56320+(a&1023)):s[i++]=(a&15)<<12|(e[t++]&63)<<6|e[t++]&63,i>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,s)),i=0);return o!=null?(i>0&&o.push(String.fromCharCode.apply(String,s.slice(0,i))),o.join("")):String.fromCharCode.apply(String,s.slice(0,i))}function Xo(e,t,r){let n=r,o,s;for(let i=0;i<e.length;++i)o=e.charCodeAt(i),o<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=o&63|128):(o&64512)===55296&&((s=e.charCodeAt(i+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++i,t[r++]=o>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=o&63|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=o&63|128);return r-n}function Tt(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function cn(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}var Yo=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Tt(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Tt(this,4);return cn(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Tt(this,4);return cn(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Tt(this,4);let t=pa(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw Tt(this,4);let t=ma(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),r=this.pos,n=this.pos+t;if(n>this.len)throw Tt(this,t);return this.pos+=t,r===n?new Uint8Array(0):this.buf.subarray(r,n)}string(){let t=this.bytes();return ba(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw Tt(this,t);this.pos+=t}else do if(this.pos>=this.len)throw Tt(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new vt(0,0),r=0;if(this.len-this.pos>4){for(;r<4;++r)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;r=0}else{for(;r<3;++r){if(this.pos>=this.len)throw Tt(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<r*7)>>>0,t}if(this.len-this.pos>4){for(;r<5;++r)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;r<5;++r){if(this.pos>=this.len)throw Tt(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Tt(this,8);let t=cn(this.buf,this.pos+=4),r=cn(this.buf,this.pos+=4);return new vt(t,r)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=Fo(this.buf,this.pos);return this.pos+=At(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function $o(e){return new Yo(e instanceof Uint8Array?e:e.subarray())}function Se(e,t,r){let n=$o(e);return t.decode(n,void 0,r)}function Wo(e){let t=e??8192,r=t>>>1,n,o=t;return function(i){if(i<1||i>r)return ot(i);o+i>t&&(n=ot(t),o=0);let a=n.subarray(o,o+=i);return(o&7)!==0&&(o=(o|7)+1),a}}var Ae=class{fn;len;next;val;constructor(t,r,n){this.fn=t,this.len=r,this.next=void 0,this.val=n}};function Jo(){}var ts=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},zu=Wo();function ju(e){return globalThis.Buffer!=null?ot(e):zu(e)}var Br=class{len;head;tail;states;constructor(){this.len=0,this.head=new Ae(Jo,0,0),this.tail=this.head,this.states=null}_push(t,r,n){return this.tail=this.tail.next=new Ae(t,r,n),this.len+=r,this}uint32(t){return this.len+=(this.tail=this.tail.next=new es((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(fn,10,vt.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let r=vt.fromBigInt(t);return this._push(fn,r.length(),r)}uint64Number(t){return this._push(Go,At(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let r=vt.fromBigInt(t).zzEncode();return this._push(fn,r.length(),r)}sint64Number(t){let r=vt.fromNumber(t).zzEncode();return this._push(fn,r.length(),r)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(Qo,1,t?1:0)}fixed32(t){return this._push(vr,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let r=vt.fromBigInt(t);return this._push(vr,4,r.lo)._push(vr,4,r.hi)}fixed64Number(t){let r=vt.fromNumber(t);return this._push(vr,4,r.lo)._push(vr,4,r.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(da,4,t)}double(t){return this._push(ya,8,t)}bytes(t){let r=t.length>>>0;return r===0?this._push(Qo,1,0):this.uint32(r)._push(Xu,r,t)}string(t){let r=xa(t);return r!==0?this.uint32(r)._push(Xo,r,t):this._push(Qo,1,0)}fork(){return this.states=new ts(this),this.head=this.tail=new Ae(Jo,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ae(Jo,0,0),this.len=0),this}ldelim(){let t=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=r,this.len+=n),this}finish(){let t=this.head.next,r=ju(this.len),n=0;for(;t!=null;)t.fn(t.val,r,n),n+=t.len,t=t.next;return r}};function Qo(e,t,r){t[r]=e&255}function Zu(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}var es=class extends Ae{next;constructor(t,r){super(Zu,t,r),this.next=void 0}};function fn(e,t,r){for(;e.hi!==0;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}function vr(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function Xu(e,t,r){t.set(e,r)}globalThis.Buffer!=null&&(Br.prototype.bytes=function(e){let t=e.length>>>0;return this.uint32(t),t>0&&this._push(Yu,t,e),this},Br.prototype.string=function(e){let t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push($u,t,e),this});function Yu(e,t,r){t.set(e,r)}function $u(e,t,r){e.length<40?Xo(e,t,r):t.utf8Write!=null?t.utf8Write(e,r):t.set($(e),r)}function rs(){return new Br}function ve(e,t){let r=rs();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var Ze;(function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"})(Ze||(Ze={}));function un(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function ns(e){function t(o){if(e[o.toString()]==null)throw new Error("Invalid enum value");return e[o]}let r=function(s,i){let a=t(s);i.int32(a)},n=function(s){let i=s.int32();return t(i)};return un("enum",Ze.VARINT,r,n)}function Be(e,t){return un("message",Ze.LENGTH_DELIMITED,e,t)}var _r=class extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"};var ct;(function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"})(ct||(ct={}));var os;(function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"})(os||(os={}));(function(e){e.codec=()=>ns(os)})(ct||(ct={}));var Xt;(function(e){let t;e.codec=()=>(t==null&&(t=Be((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),ct.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.Type=ct.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>ve(r,e.codec()),e.decode=(r,n)=>Se(r,e.codec(),n)})(Xt||(Xt={}));var ss;(function(e){let t;e.codec=()=>(t==null&&(t=Be((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),ct.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.Type=ct.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>ve(r,e.codec()),e.decode=(r,n)=>Se(r,e.codec(),n)})(ss||(ss={}));var Lr={};bt(Lr,{MAX_RSA_KEY_SIZE:()=>is,generateRSAKeyPair:()=>Ba,jwkToJWKKeyPair:()=>_a,jwkToPkcs1:()=>th,jwkToPkix:()=>us,jwkToRSAPrivateKey:()=>ps,pkcs1MessageToJwk:()=>cs,pkcs1MessageToRSAPrivateKey:()=>hs,pkcs1ToJwk:()=>Qu,pkcs1ToRSAPrivateKey:()=>va,pkixMessageToJwk:()=>fs,pkixMessageToRSAPublicKey:()=>ds,pkixToJwk:()=>eh,pkixToRSAPublicKey:()=>ls});var he=Xr;var Xe=class{type="RSA";jwk;_raw;_multihash;constructor(t,r){this.jwk=t,this._multihash=r}get raw(){return this._raw==null&&(this._raw=Lr.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return ht.createV1(114,this._multihash)}toString(){return et.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:mt(this.raw,t.raw)}verify(t,r,n){return Aa(this.jwk,r,t,n)}},Ir=class{type="RSA";jwk;_raw;publicKey;constructor(t,r){this.jwk=t,this.publicKey=r}get raw(){return this._raw==null&&(this._raw=Lr.jwkToPkcs1(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:mt(this.raw,t.raw)}sign(t,r){return Sa(this.jwk,t,r)}};var is=8192,as=18,Wu=1062,Ju=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function Qu(e){let t=kt(e);return cs(t)}function cs(e){return{n:z(e[1],"base64url"),e:z(e[2],"base64url"),d:z(e[3],"base64url"),p:z(e[4],"base64url"),q:z(e[5],"base64url"),dp:z(e[6],"base64url"),dq:z(e[7],"base64url"),qi:z(e[8],"base64url"),kty:"RSA"}}function th(e){if(e.n==null||e.e==null||e.d==null||e.p==null||e.q==null||e.dp==null||e.dq==null||e.qi==null)throw new rt("JWK was missing components");return te([wt(Uint8Array.from([0])),wt($(e.n,"base64url")),wt($(e.e,"base64url")),wt($(e.d,"base64url")),wt($(e.p,"base64url")),wt($(e.q,"base64url")),wt($(e.dp,"base64url")),wt($(e.dq,"base64url")),wt($(e.qi,"base64url"))]).subarray()}function eh(e){let t=kt(e,{offset:0});return fs(t)}function fs(e){let t=kt(e[1],{offset:0});return{kty:"RSA",n:z(t[0],"base64url"),e:z(t[1],"base64url")}}function us(e){if(e.n==null||e.e==null)throw new rt("JWK was missing components");return te([Ju,Fr(te([wt($(e.n,"base64url")),wt($(e.e,"base64url"))]))]).subarray()}function va(e){let t=kt(e);return hs(t)}function hs(e){let t=cs(e);return ps(t)}function ls(e,t){if(e.byteLength>=Wu)throw new Ke("Key size is too large");let r=kt(e,{offset:0});return ds(r,e,t)}function ds(e,t,r){let n=fs(e);if(r==null){let o=he(Xt.encode({Type:ct.RSA,Data:t}));r=Ut(as,o)}return new Xe(n,r)}function ps(e){if(La(e)>is)throw new rt("Key size is too large");let t=_a(e),r=he(Xt.encode({Type:ct.RSA,Data:us(t.publicKey)})),n=Ut(as,r);return new Ir(t.privateKey,new Xe(t.publicKey,n))}async function Ba(e){if(e>is)throw new rt("Key size is too large");let t=await Ia(e),r=he(Xt.encode({Type:ct.RSA,Data:us(t.publicKey)})),n=Ut(as,r);return new Ir(t.privateKey,new Xe(t.publicKey,n))}function _a(e){if(e==null)throw new rt("Missing key parameter");return{privateKey:e,publicKey:{kty:e.kty,n:e.n,e:e.e}}}async function Ia(e,t){let r=await It.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);t?.signal?.throwIfAborted();let n=await rh(r,t);return{privateKey:n[0],publicKey:n[1]}}async function Sa(e,t,r){let n=await It.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);r?.signal?.throwIfAborted();let o=await It.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function Aa(e,t,r,n){let o=await It.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();let s=await It.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},o,t,r instanceof Uint8Array?r:r.subarray());return n?.signal?.throwIfAborted(),s}async function rh(e,t){if(e.privateKey==null||e.publicKey==null)throw new rt("Private and public key are required");let r=await Promise.all([It.get().subtle.exportKey("jwk",e.privateKey),It.get().subtle.exportKey("jwk",e.publicKey)]);return t?.signal?.throwIfAborted(),r}function La(e){if(e.kty!=="RSA")throw new rt("invalid key type");if(e.n==null)throw new rt("invalid key modulus");return $(e.n,"base64url").length*8}var hn=class extends Me{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,ye(t);let n=re(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(n.length>o?t.create().update(n).digest():n);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),Lt(s)}update(t){return Oe(this),this.iHash.update(t),this}digestInto(t){Oe(this),lt(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Ye=(e,t,r)=>new hn(e,t).update(r).digest();Ye.create=(e,t)=>new hn(e,t);var Ka=(e,t)=>(e+(e>=0?t:-t)/Ta)/t;function nh(e,t,r){let[[n,o],[s,i]]=t,a=Ka(i*e,r),c=Ka(-o*e,r),f=e-a*n-c*s,l=-a*o-c*i,h=f<$t,u=l<$t;h&&(f=-f),u&&(l=-l);let p=ce(Math.ceil($r(r)/2))+We;if(f<$t||f>=p||l<$t||l>=p)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:h,k1:f,k2neg:u,k2:l}}function ms(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function ys(e,t){let r={};for(let n of Object.keys(t))r[n]=e[n]===void 0?t[n]:e[n];return qt(r.lowS,"lowS"),qt(r.prehash,"prehash"),r.format!==void 0&&ms(r.format),r}var gs=class extends Error{constructor(t=""){super(t)}},Yt={Err:gs,_tlv:{encode:(e,t)=>{let{Err:r}=Yt;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length&1)throw new r("tlv.encode: unpadded data");let n=t.length/2,o=mr(n);if(o.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?mr(o.length/2|128):"";return mr(e)+s+o+t},decode(e,t){let{Err:r}=Yt,n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");let o=t[n++],s=!!(o&128),i=0;if(!s)i=o;else{let c=o&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");let f=t.subarray(n,n+c);if(f.length!==c)throw new r("tlv.decode: length bytes not complete");if(f[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let l of f)i=i<<8|l;if(n+=c,i<128)throw new r("tlv.decode(long): not minimal encoding")}let a=t.subarray(n,n+i);if(a.length!==i)throw new r("tlv.decode: wrong value length");return{v:a,l:t.subarray(n+i)}}},_int:{encode(e){let{Err:t}=Yt;if(e<$t)throw new t("integer: negative integers are not allowed");let r=mr(e);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=Yt;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return He(e)}},toSig(e){let{Err:t,_int:r,_tlv:n}=Yt,o=j("signature",e),{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,s),{v:f,l}=n.decode(2,c);if(l.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(f)}},hexFromSig(e){let{_tlv:t,_int:r}=Yt,n=t.encode(2,r.encode(e.r)),o=t.encode(2,r.encode(e.s)),s=n+o;return t.encode(48,s)}},$t=BigInt(0),We=BigInt(1),Ta=BigInt(2),ln=BigInt(3),oh=BigInt(4);function $e(e,t){let{BYTES:r}=e,n;if(typeof t=="bigint")n=t;else{let o=j("private key",t);try{n=e.fromBytes(o)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof t}`)}}if(!e.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function sh(e,t={}){let r=Jr("weierstrass",e,t),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i,n:a}=s;Pt(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:c}=t;if(c&&(!n.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let f=Ua(n,o);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(T,y,m){let{x,y:v}=y.toAffine(),_=n.toBytes(x);if(qt(m,"isCompressed"),m){l();let L=!n.isOdd(v);return gt(Ca(L),_)}else return gt(Uint8Array.of(4),_,n.toBytes(v))}function u(T){Et(T,void 0,"Point");let{publicKey:y,publicKeyUncompressed:m}=f,x=T.length,v=T[0],_=T.subarray(1);if(x===y&&(v===2||v===3)){let L=n.fromBytes(_);if(!n.isValid(L))throw new Error("bad point: is not on curve, wrong x");let A=w(L),I;try{I=n.sqrt(A)}catch(q){let V=q instanceof Error?": "+q.message:"";throw new Error("bad point: is not on curve, sqrt error"+V)}l();let C=n.isOdd(I);return(v&1)===1!==C&&(I=n.neg(I)),{x:L,y:I}}else if(x===m&&v===4){let L=n.BYTES,A=n.fromBytes(_.subarray(0,L)),I=n.fromBytes(_.subarray(L,L*2));if(!g(A,I))throw new Error("bad point: is not on curve");return{x:A,y:I}}else throw new Error(`bad point: got length ${x}, expected compressed=${y} or uncompressed=${m}`)}let p=t.toBytes||h,d=t.fromBytes||u;function w(T){let y=n.sqr(T),m=n.mul(y,T);return n.add(n.add(m,n.mul(T,s.a)),s.b)}function g(T,y){let m=n.sqr(y),x=w(T);return n.eql(m,x)}if(!g(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let b=n.mul(n.pow(s.a,ln),oh),B=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(b,B)))throw new Error("bad curve params: a or b");function E(T,y,m=!1){if(!n.isValid(y)||m&&n.is0(y))throw new Error(`bad point coordinate ${T}`);return y}function U(T){if(!(T instanceof S))throw new Error("ProjectivePoint expected")}function k(T){if(!c||!c.basises)throw new Error("no endo");return nh(T,c.basises,o.ORDER)}let O=qe((T,y)=>{let{X:m,Y:x,Z:v}=T;if(n.eql(v,n.ONE))return{x:m,y:x};let _=T.is0();y==null&&(y=_?n.ONE:n.inv(v));let L=n.mul(m,y),A=n.mul(x,y),I=n.mul(v,y);if(_)return{x:n.ZERO,y:n.ZERO};if(!n.eql(I,n.ONE))throw new Error("invZ was invalid");return{x:L,y:A}}),M=qe(T=>{if(T.is0()){if(t.allowInfinityPoint&&!n.is0(T.Y))return;throw new Error("bad point: ZERO")}let{x:y,y:m}=T.toAffine();if(!n.isValid(y)||!n.isValid(m))throw new Error("bad point: x or y not field elements");if(!g(y,m))throw new Error("bad point: equation left != right");if(!T.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function P(T,y,m,x,v){return m=new S(n.mul(m.X,T),m.Y,m.Z),y=br(x,y),m=br(v,m),y.add(m)}class S{constructor(y,m,x){this.X=E("x",y),this.Y=E("y",m,!0),this.Z=E("z",x),Object.freeze(this)}static CURVE(){return s}static fromAffine(y){let{x:m,y:x}=y||{};if(!y||!n.isValid(m)||!n.isValid(x))throw new Error("invalid affine point");if(y instanceof S)throw new Error("projective point not allowed");return n.is0(m)&&n.is0(x)?S.ZERO:new S(m,x,n.ONE)}static fromBytes(y){let m=S.fromAffine(d(Et(y,void 0,"point")));return m.assertValidity(),m}static fromHex(y){return S.fromBytes(j("pointHex",y))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(y=8,m=!0){return D.createCache(this,y),m||this.multiply(ln),this}assertValidity(){M(this)}hasEvenY(){let{y}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(y)}equals(y){U(y);let{X:m,Y:x,Z:v}=this,{X:_,Y:L,Z:A}=y,I=n.eql(n.mul(m,A),n.mul(_,v)),C=n.eql(n.mul(x,A),n.mul(L,v));return I&&C}negate(){return new S(this.X,n.neg(this.Y),this.Z)}double(){let{a:y,b:m}=s,x=n.mul(m,ln),{X:v,Y:_,Z:L}=this,A=n.ZERO,I=n.ZERO,C=n.ZERO,R=n.mul(v,v),q=n.mul(_,_),V=n.mul(L,L),H=n.mul(v,_);return H=n.add(H,H),C=n.mul(v,L),C=n.add(C,C),A=n.mul(y,C),I=n.mul(x,V),I=n.add(A,I),A=n.sub(q,I),I=n.add(q,I),I=n.mul(A,I),A=n.mul(H,A),C=n.mul(x,C),V=n.mul(y,V),H=n.sub(R,V),H=n.mul(y,H),H=n.add(H,C),C=n.add(R,R),R=n.add(C,R),R=n.add(R,V),R=n.mul(R,H),I=n.add(I,R),V=n.mul(_,L),V=n.add(V,V),R=n.mul(V,H),A=n.sub(A,R),C=n.mul(V,q),C=n.add(C,C),C=n.add(C,C),new S(A,I,C)}add(y){U(y);let{X:m,Y:x,Z:v}=this,{X:_,Y:L,Z:A}=y,I=n.ZERO,C=n.ZERO,R=n.ZERO,q=s.a,V=n.mul(s.b,ln),H=n.mul(m,_),G=n.mul(x,L),Z=n.mul(v,A),Q=n.add(m,x),F=n.add(_,L);Q=n.mul(Q,F),F=n.add(H,G),Q=n.sub(Q,F),F=n.add(m,v);let st=n.add(_,A);return F=n.mul(F,st),st=n.add(H,Z),F=n.sub(F,st),st=n.add(x,v),I=n.add(L,A),st=n.mul(st,I),I=n.add(G,Z),st=n.sub(st,I),R=n.mul(q,F),I=n.mul(V,Z),R=n.add(I,R),I=n.sub(G,R),R=n.add(G,R),C=n.mul(I,R),G=n.add(H,H),G=n.add(G,H),Z=n.mul(q,Z),F=n.mul(V,F),G=n.add(G,Z),Z=n.sub(H,Z),Z=n.mul(q,Z),F=n.add(F,Z),H=n.mul(G,F),C=n.add(C,H),H=n.mul(st,F),I=n.mul(Q,I),I=n.sub(I,H),H=n.mul(Q,G),R=n.mul(st,R),R=n.add(R,H),new S(I,C,R)}subtract(y){return this.add(y.negate())}is0(){return this.equals(S.ZERO)}multiply(y){let{endo:m}=t;if(!o.isValidNot0(y))throw new Error("invalid scalar: out of range");let x,v,_=L=>D.cached(this,L,A=>Gt(S,A));if(m){let{k1neg:L,k1:A,k2neg:I,k2:C}=k(y),{p:R,f:q}=_(A),{p:V,f:H}=_(C);v=q.add(H),x=P(m.beta,R,V,L,I)}else{let{p:L,f:A}=_(y);x=L,v=A}return Gt(S,[x,v])[0]}multiplyUnsafe(y){let{endo:m}=t,x=this;if(!o.isValid(y))throw new Error("invalid scalar: out of range");if(y===$t||x.is0())return S.ZERO;if(y===We)return x;if(D.hasCache(this))return this.multiply(y);if(m){let{k1neg:v,k1:_,k2neg:L,k2:A}=k(y),{p1:I,p2:C}=ea(S,x,_,A);return P(m.beta,I,C,v,L)}else return D.unsafe(x,y)}multiplyAndAddUnsafe(y,m,x){let v=this.multiplyUnsafe(m).add(y.multiplyUnsafe(x));return v.is0()?void 0:v}toAffine(y){return O(this,y)}isTorsionFree(){let{isTorsionFree:y}=t;return i===We?!0:y?y(S,this):D.unsafe(this,a).is0()}clearCofactor(){let{clearCofactor:y}=t;return i===We?this:y?y(S,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(y=!0){return qt(y,"isCompressed"),this.assertValidity(),p(S,this,y)}toHex(y=!0){return Bt(this.toBytes(y))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(y=!0){return this.toBytes(y)}_setWindowSize(y){this.precompute(y)}static normalizeZ(y){return Gt(S,y)}static msm(y,m){return Fe(S,o,y,m)}static fromPrivateKey(y){return S.BASE.multiply($e(o,y))}}S.BASE=new S(s.Gx,s.Gy,n.ONE),S.ZERO=new S(n.ZERO,n.ONE,n.ZERO),S.Fp=n,S.Fn=o;let K=o.BITS,D=new Ge(S,t.endo?Math.ceil(K/2):K);return S.BASE.precompute(8),S}function Ca(e){return Uint8Array.of(e?2:3)}function Ua(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function ih(e,t={}){let{Fn:r}=e,n=t.randomBytes||ne,o=Object.assign(Ua(e.Fp,r),{seed:Io(r.ORDER)});function s(p){try{return!!$e(r,p)}catch{return!1}}function i(p,d){let{publicKey:w,publicKeyUncompressed:g}=o;try{let b=p.length;return d===!0&&b!==w||d===!1&&b!==g?!1:!!e.fromBytes(p)}catch{return!1}}function a(p=n(o.seed)){return Lo(Et(p,o.seed,"seed"),r.ORDER)}function c(p,d=!0){return e.BASE.multiply($e(r,p)).toBytes(d)}function f(p){let d=a(p);return{secretKey:d,publicKey:c(d)}}function l(p){if(typeof p=="bigint")return!1;if(p instanceof e)return!0;let{secretKey:d,publicKey:w,publicKeyUncompressed:g}=o;if(r.allowedLengths||d===w)return;let b=j("key",p).length;return b===w||b===g}function h(p,d,w=!0){if(l(p)===!0)throw new Error("first arg must be private key");if(l(d)===!1)throw new Error("second arg must be public key");let g=$e(r,p);return e.fromHex(d).multiply(g).toBytes(w)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:f,Point:e,utils:{isValidSecretKey:s,isValidPublicKey:i,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:p=>$e(r,p),precompute(p=8,d=e.BASE){return d.precompute(p,!1)}},lengths:o})}function ah(e,t,r={}){ye(t),Pt(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let n=r.randomBytes||ne,o=r.hmac||((m,...x)=>Ye(t,m,gt(...x))),{Fp:s,Fn:i}=e,{ORDER:a,BITS:c}=i,{keygen:f,getPublicKey:l,getSharedSecret:h,utils:u,lengths:p}=ih(e,r),d={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},w="compact";function g(m){let x=a>>We;return m>x}function b(m,x){if(!i.isValidNot0(x))throw new Error(`invalid signature ${m}: out of range 1..Point.Fn.ORDER`);return x}function B(m,x){ms(x);let v=p.signature,_=x==="compact"?v:x==="recovered"?v+1:void 0;return Et(m,_,`${x} signature`)}class E{constructor(x,v,_){this.r=b("r",x),this.s=b("s",v),_!=null&&(this.recovery=_),Object.freeze(this)}static fromBytes(x,v=w){B(x,v);let _;if(v==="der"){let{r:C,s:R}=Yt.toSig(Et(x));return new E(C,R)}v==="recovered"&&(_=x[0],v="compact",x=x.subarray(1));let L=i.BYTES,A=x.subarray(0,L),I=x.subarray(L,L*2);return new E(i.fromBytes(A),i.fromBytes(I),_)}static fromHex(x,v){return this.fromBytes(me(x),v)}addRecoveryBit(x){return new E(this.r,this.s,x)}recoverPublicKey(x){let v=s.ORDER,{r:_,s:L,recovery:A}=this;if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");if(a*Ta<v&&A>1)throw new Error("recovery id is ambiguous for h>1 curve");let C=A===2||A===3?_+a:_;if(!s.isValid(C))throw new Error("recovery id 2 or 3 invalid");let R=s.toBytes(C),q=e.fromBytes(gt(Ca((A&1)===0),R)),V=i.inv(C),H=k(j("msgHash",x)),G=i.create(-H*V),Z=i.create(L*V),Q=e.BASE.multiplyUnsafe(G).add(q.multiplyUnsafe(Z));if(Q.is0())throw new Error("point at infinify");return Q.assertValidity(),Q}hasHighS(){return g(this.s)}toBytes(x=w){if(ms(x),x==="der")return me(Yt.hexFromSig(this));let v=i.toBytes(this.r),_=i.toBytes(this.s);if(x==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return gt(Uint8Array.of(this.recovery),v,_)}return gt(v,_)}toHex(x){return Bt(this.toBytes(x))}assertValidity(){}static fromCompact(x){return E.fromBytes(j("sig",x),"compact")}static fromDER(x){return E.fromBytes(j("sig",x),"der")}normalizeS(){return this.hasHighS()?new E(this.r,i.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Bt(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Bt(this.toBytes("compact"))}}let U=r.bits2int||function(x){if(x.length>8192)throw new Error("input is too large");let v=He(x),_=x.length*8-c;return _>0?v>>BigInt(_):v},k=r.bits2int_modN||function(x){return i.create(U(x))},O=ce(c);function M(m){return ae("num < 2^"+c,m,$t,O),i.toBytes(m)}function P(m,x){return Et(m,void 0,"message"),x?Et(t(m),void 0,"prehashed message"):m}function S(m,x,v){if(["recovered","canonical"].some(G=>G in v))throw new Error("sign() legacy options not supported");let{lowS:_,prehash:L,extraEntropy:A}=ys(v,d);m=P(m,L);let I=k(m),C=$e(i,x),R=[M(C),M(I)];if(A!=null&&A!==!1){let G=A===!0?n(p.secretKey):A;R.push(j("extraEntropy",G))}let q=gt(...R),V=I;function H(G){let Z=U(G);if(!i.isValidNot0(Z))return;let Q=i.inv(Z),F=e.BASE.multiply(Z).toAffine(),st=i.create(F.x);if(st===$t)return;let Le=i.create(Q*i.create(V+st*C));if(Le===$t)return;let sr=(F.x===st?0:2)|Number(F.y&We),ir=Le;return _&&g(Le)&&(ir=i.neg(Le),sr^=1),new E(st,ir,sr)}return{seed:q,k2sig:H}}function K(m,x,v={}){m=j("message",m);let{seed:_,k2sig:L}=S(m,x,v);return Oi(t.outputLen,i.BYTES,o)(_,L)}function D(m){let x,v=typeof m=="string"||Ot(m),_=!v&&m!==null&&typeof m=="object"&&typeof m.r=="bigint"&&typeof m.s=="bigint";if(!v&&!_)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(_)x=new E(m.r,m.s);else if(v){try{x=E.fromBytes(j("sig",m),"der")}catch(L){if(!(L instanceof Yt.Err))throw L}if(!x)try{x=E.fromBytes(j("sig",m),"compact")}catch{return!1}}return x||!1}function T(m,x,v,_={}){let{lowS:L,prehash:A,format:I}=ys(_,d);if(v=j("publicKey",v),x=P(j("message",x),A),"strict"in _)throw new Error("options.strict was renamed to lowS");let C=I===void 0?D(m):E.fromBytes(j("sig",m),I);if(C===!1)return!1;try{let R=e.fromBytes(v);if(L&&C.hasHighS())return!1;let{r:q,s:V}=C,H=k(x),G=i.inv(V),Z=i.create(H*G),Q=i.create(q*G),F=e.BASE.multiplyUnsafe(Z).add(R.multiplyUnsafe(Q));return F.is0()?!1:i.create(F.x)===q}catch{return!1}}function y(m,x,v={}){let{prehash:_}=ys(v,d);return x=P(x,_),E.fromBytes(m,"recovered").recoverPublicKey(x).toBytes()}return Object.freeze({keygen:f,getPublicKey:l,getSharedSecret:h,utils:u,lengths:p,Point:e,sign:K,verify:T,recoverPublicKey:y,Signature:E,hash:t})}function ch(e){let t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,n=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(i=>Math.ceil(i/2)))):void 0,o=St(t.n,{BITS:e.nBitLength,allowedLengths:n,modFromBytes:e.wrapPrivateKey}),s={Fp:r,Fn:o,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes};return{CURVE:t,curveOpts:s}}function fh(e){let{CURVE:t,curveOpts:r}=ch(e),n={hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:t,curveOpts:r,hash:e.hash,ecdsaOpts:n}}function uh(e,t){let r=t.Point;return Object.assign({},t,{ProjectivePoint:r,CURVE:Object.assign({},e,Wr(r.Fn.ORDER,r.Fn.BITS))})}function Da(e){let{CURVE:t,curveOpts:r,hash:n,ecdsaOpts:o}=fh(e),s=sh(t,r),i=ah(s,n,o);return uh(e,i)}function Ra(e,t){let r=n=>Da({...e,hash:n});return{...r(t),create:r}}var bs={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},hh={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]};var Pa=BigInt(2);function lh(e){let t=bs.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),f=e*e*e%t,l=f*f*e%t,h=J(l,r,t)*l%t,u=J(h,r,t)*l%t,p=J(u,Pa,t)*f%t,d=J(p,o,t)*p%t,w=J(d,s,t)*d%t,g=J(w,a,t)*w%t,b=J(g,c,t)*g%t,B=J(b,a,t)*w%t,E=J(B,r,t)*l%t,U=J(E,i,t)*d%t,k=J(U,n,t)*f%t,O=J(k,Pa,t);if(!xs.eql(xs.sqr(O),e))throw new Error("Cannot find square root");return O}var xs=St(bs.p,{sqrt:lh}),Je=Ra({...bs,Fp:xs,lowS:!0,endo:hh},Xr);function Na(e,t,r,n){let o=Vr.digest(r instanceof Uint8Array?r:r.subarray());if(nn(o))return o.then(({digest:s})=>(n?.signal?.throwIfAborted(),Je.verify(t,s,e))).catch(s=>{throw s.name==="AbortError"?s:new Ar(String(s))});try{return n?.signal?.throwIfAborted(),Je.verify(t,o.digest,e)}catch(s){throw new Ar(String(s))}}var dn=class{type="secp256k1";raw;_key;constructor(t){this._key=Ma(t),this.raw=ka(this._key)}toMultihash(){return Dt.digest(ee(this))}toCID(){return ht.createV1(114,this.toMultihash())}toString(){return et.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:mt(this.raw,t.raw)}verify(t,r,n){return Na(this._key,r,t,n)}};function Oa(e){return new dn(e)}function ka(e){return Je.ProjectivePoint.fromHex(e).toRawBytes(!0)}function Ma(e){try{return Je.ProjectivePoint.fromHex(e),e}catch(t){throw new Ke(String(t))}}function Kr(e,t){let{Type:r,Data:n}=Xt.decode(e),o=n??new Uint8Array;switch(r){case ct.RSA:return ls(o,t);case ct.Ed25519:return la(o);case ct.secp256k1:return Oa(o);case ct.ECDSA:return xi(o);default:throw new Te}}function ee(e){return Xt.encode({Type:ct[e.type],Data:e.raw})}var Ha=Symbol.for("nodejs.util.inspect.custom"),dh=114,Tr=class{type;multihash;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[On]=!0;toString(){return this.string==null&&(this.string=et.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return ht.createV1(dh,this.multihash)}toJSON(){return this.toString()}equals(t){if(t==null)return!1;if(t instanceof Uint8Array)return mt(this.multihash.bytes,t);if(typeof t=="string")return this.toString()===t;if(t?.toMultihash()?.bytes!=null)return mt(this.multihash.bytes,t.toMultihash().bytes);throw new Error("not valid Id")}[Ha](){return`PeerId(${this.toString()})`}},pn=class extends Tr{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}},yn=class extends Tr{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.publicKey}},mn=class extends Tr{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.publicKey}},ph=2336,ws=class{type="url";multihash;publicKey;url;constructor(t){this.url=t.toString(),this.multihash=Dt.digest($(this.url))}[Ha](){return`PeerId(${this.url})`}[On]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return ht.createV1(ph,this.toMultihash())}toJSON(){return this.toString()}equals(t){return t==null?!1:(t instanceof Uint8Array&&(t=z(t)),t.toString()===this.toString())}};function Es(e){if(e.type==="Ed25519")return new yn({multihash:e.toCID().multihash,publicKey:e});if(e.type==="secp256k1")return new mn({multihash:e.toCID().multihash,publicKey:e});if(e.type==="RSA")return new pn({multihash:e.toCID().multihash,publicKey:e});throw new Te}var gn=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},Qe=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},xn=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"},Cr=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function bn(e){return e[Symbol.asyncIterator]!=null}function qa(e,t){if(e.byteLength>t)throw new Qe("Message length too long")}var En=e=>{let t=At(e),r=ot(t);return sn(e,r),En.bytes=t,r};En.bytes=0;function Va(e,t){t=t??{};let r=t.lengthEncoder??En,n=t?.maxDataLength??4194304;function*o(s){qa(s,n);let i=r(s.byteLength);i instanceof Uint8Array?yield i:yield*i,s instanceof Uint8Array?yield s:yield*s}return bn(e)?(async function*(){for await(let s of e)yield*o(s)})():(function*(){for(let s of e)yield*o(s)})()}Va.single=(e,t)=>{t=t??{};let r=t.lengthEncoder??En,n=t?.maxDataLength??4194304;return qa(e,n),new X(r(e.byteLength),e)};var _e;(function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"})(_e||(_e={}));var Ss=e=>{let t=an(e);return Ss.bytes=At(t),t};Ss.bytes=0;function Ur(e,t){let r=new X,n=_e.LENGTH,o=-1,s=t?.lengthDecoder??Ss,i=t?.maxLengthLength??8,a=t?.maxDataLength??4194304;function*c(){for(;r.byteLength>0;){if(n===_e.LENGTH)try{if(o=s(r),o<0)throw new gn("Invalid message length");if(o>a)throw new Qe("Message length too long");let f=s.bytes;r.consume(f),t?.onLength!=null&&t.onLength(o),n=_e.DATA}catch(f){if(f instanceof RangeError){if(r.byteLength>i)throw new xn("Message length length too long");break}throw f}if(n===_e.DATA){if(r.byteLength<o)break;let f=r.sublist(0,o);r.consume(o),t?.onData!=null&&t.onData(f),yield f,n=_e.LENGTH}}}return bn(e)?(async function*(){for await(let f of e)r.append(f),yield*c();if(r.byteLength>0)throw new Cr("Unexpected end of input")})():(function*(){for(let f of e)r.append(f),yield*c();if(r.byteLength>0)throw new Cr("Unexpected end of input")})()}Ur.fromReader=(e,t)=>{let r=1,n=(async function*(){for(;;)try{let{done:s,value:i}=await e.next(r);if(s===!0)return;i!=null&&(yield i)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{r=1}})();return Ur(n,{...t??{},onLength:s=>{r=s}})};function Ct(){let e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e}var Sn=class extends Error{type;code;constructor(t,r,n){super(t??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=r??"ABORT_ERR"}};async function Dr(e,t,r){if(t==null)return e;if(t.aborted)return e.catch(()=>{}),Promise.reject(new Sn(r?.errorMessage,r?.errorCode,r?.errorName));let n,o=new Sn(r?.errorMessage,r?.errorCode,r?.errorName);try{return await Promise.race([e,new Promise((s,i)=>{n=()=>{i(o)},t.addEventListener("abort",n)})])}finally{n!=null&&t.removeEventListener("abort",n)}}var As=class{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=Ct(),this.haveNext=Ct()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");let t=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Ct(),t}async throw(t){return this.ended=!0,this.error=t,t!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(t)),{done:!0,value:void 0}}async return(){let t={done:!0,value:void 0};return this.ended=!0,this.nextResult=t,this.haveNext.resolve(),t}async push(t,r){await this._push(t,r)}async end(t,r){t!=null?await this.throw(t):await this._push(void 0,r)}async _push(t,r){if(t!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;t!=null?this.nextResult={done:!1,value:t}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Ct(),await Dr(this.readNext.promise,r?.signal,r)}};function An(){return new As}var vn=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function Ga(e,t){let r=An();e.sink(r).catch(async i=>{await r.end(i)}),e.sink=async i=>{for await(let a of i)await r.push(a);await r.end()};let n=e.source;e.source[Symbol.iterator]!=null?n=e.source[Symbol.iterator]():e.source[Symbol.asyncIterator]!=null&&(n=e.source[Symbol.asyncIterator]());let o=new X;return{read:async i=>{if(i?.signal?.throwIfAborted(),i?.bytes==null){let{done:c,value:f}=await Dr(n.next(),i?.signal);return c===!0?null:f}for(;o.byteLength<i.bytes;){let{value:c,done:f}=await Dr(n.next(),i?.signal);if(f===!0)throw new vn("unexpected end of input");o.append(c)}let a=o.sublist(0,i.bytes);return o.consume(i.bytes),a},write:async(i,a)=>{a?.signal?.throwIfAborted(),i instanceof Uint8Array?await r.push(i,a):await r.push(i.subarray(),a)},unwrap:()=>{if(o.byteLength>0){let i=e.source;e.source=(async function*(){t?.yieldBytes===!1?yield o:yield*o,yield*i})()}return e}}}var Bn=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},_n=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},In=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function vs(e,t={}){let r=Ga(e,t);t.maxDataLength!=null&&t.maxLengthLength==null&&(t.maxLengthLength=At(t.maxDataLength));let n=t?.lengthDecoder??an,o=t?.lengthEncoder??sn;return{read:async i=>{let a=-1,c=new X;for(;;){c.append(await r.read({...i,bytes:1}));try{a=n(c)}catch(f){if(f instanceof RangeError)continue;throw f}if(a<0)throw new Bn("Invalid message length");if(t?.maxLengthLength!=null&&c.byteLength>t.maxLengthLength)throw new In("message length length too long");if(a>-1)break}if(t?.maxDataLength!=null&&a>t.maxDataLength)throw new _n("message length too long");return r.read({...i,bytes:a})},write:async(i,a)=>{await r.write(new X(o(i.byteLength),i),a)},writeV:async(i,a)=>{let c=new X(...i.flatMap(f=>[o(f.byteLength),f]));await r.write(c,a)},unwrap:()=>r.unwrap()}}function Bs(){let e=Ct(),t=!1;return{sink:async r=>{if(t)throw new Error("already piped");t=!0,e.resolve(r)},source:(async function*(){yield*await e.promise})()}}function Fa(){let e=Bs(),t=Bs();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]}var Ln=class{buffer;mask;top;btm;next;constructor(t){if(!(t>0)||(t-1&t)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){let t=this.buffer[this.btm];if(t!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}isEmpty(){return this.buffer[this.btm]===void 0}},tr=class{size;hwm;head;tail;constructor(t={}){this.hwm=t.splitLimit??16,this.head=new Ln(this.hwm),this.tail=this.head,this.size=0}calculateSize(t){return t?.byteLength!=null?t.byteLength:1}push(t){if(t?.value!=null&&(this.size+=this.calculateSize(t.value)),!this.head.push(t)){let r=this.head;this.head=r.next=new Ln(2*this.head.buffer.length),this.head.push(t)}}shift(){let t=this.tail.shift();if(t===void 0&&this.tail.next!=null){let r=this.tail.next;this.tail.next=null,this.tail=r,t=this.tail.shift()}return t?.value!=null&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}};var _s=class extends Error{type;code;constructor(t,r){super(t??"The operation was aborted"),this.type="aborted",this.code=r??"ABORT_ERR"}};function za(e={}){return mh(r=>{let n=r.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},e)}function mh(e,t){t=t??{};let r=t.onEnd,n=new tr,o,s,i,a=Ct(),c=async()=>{try{return n.isEmpty()?i?{done:!0}:await new Promise((g,b)=>{s=B=>{s=null,n.push(B);try{g(e(n))}catch(E){b(E)}return o}}):e(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Ct()})}},f=g=>s!=null?s(g):(n.push(g),o),l=g=>(n=new tr,s!=null?s({error:g}):(n.push({error:g}),o)),h=g=>{if(i)return o;if(t?.objectMode!==!0&&g?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return f({done:!1,value:g})},u=g=>i?o:(i=!0,g!=null?l(g):f({done:!0})),p=()=>(n=new tr,u(),{done:!0}),d=g=>(u(g),{done:!0});if(o={[Symbol.asyncIterator](){return this},next:c,return:p,throw:d,push:h,end:u,get readableLength(){return n.size},onEmpty:async g=>{let b=g?.signal;if(b?.throwIfAborted(),n.isEmpty())return;let B,E;b!=null&&(B=new Promise((U,k)=>{E=()=>{k(new _s)},b.addEventListener("abort",E)}));try{await Promise.race([a.promise,B])}finally{E!=null&&b!=null&&b?.removeEventListener("abort",E)}}},r==null)return o;let w=o;return o={[Symbol.asyncIterator](){return this},next(){return w.next()},throw(g){return w.throw(g),r!=null&&(r(g),r=void 0),{done:!0}},return(){return w.return(),r!=null&&(r(),r=void 0),{done:!0}},push:h,end(g){return w.end(g),r!=null&&(r(g),r=void 0),o},get readableLength(){return w.readableLength},onEmpty:g=>w.onEmpty(g)},o}function gh(e){return e[Symbol.asyncIterator]!=null}async function xh(e,t,r){try{await Promise.all(e.map(async n=>{for await(let o of n)await t.push(o,{signal:r}),r.throwIfAborted()})),await t.end(void 0,{signal:r})}catch(n){await t.end(n,{signal:r}).catch(()=>{})}}async function*bh(e){let t=new AbortController,r=An();xh(e,r,t.signal).catch(()=>{});try{yield*r}finally{t.abort()}}function*wh(e){for(let t of e)yield*t}function Eh(...e){let t=[];for(let r of e)gh(r)||t.push(r);return t.length===e.length?wh(t):bh(e)}var ja=Eh;function Za(e,...t){if(e==null)throw new Error("Empty pipeline");if(Is(e)){let n=e;e=()=>n.source}else if(Ya(e)||Xa(e)){let n=e;e=()=>n}let r=[e,...t];if(r.length>1&&Is(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let n=1;n<r.length-1;n++)Is(r[n])&&(r[n]=Ah(r[n]));return Sh(...r)}var Sh=(...e)=>{let t;for(;e.length>0;)t=e.shift()(t);return t},Xa=e=>e?.[Symbol.asyncIterator]!=null,Ya=e=>e?.[Symbol.iterator]!=null,Is=e=>e==null?!1:e.sink!=null&&e.source!=null,Ah=e=>t=>{let r=e.sink(t);if(r?.then!=null){let n=za({objectMode:!0});r.then(()=>{n.end()},i=>{n.end(i)});let o,s=e.source;if(Xa(s))o=async function*(){yield*s,n.end()};else if(Ya(s))o=function*(){yield*s,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return ja(n,o())}return e.source};var er=!!globalThis.process?.env?.DUMP_SESSION_KEYS;function Wa(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Kn(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function Tn(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function yt(e,...t){if(!Wa(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Ls(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Ja(e,t){yt(e);let r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Wt(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Jt(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function vh(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}var Bh=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function _h(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function Cn(e){if(typeof e=="string")e=_h(e);else if(Wa(e))e=Un(e);else throw new Error("Uint8Array expected, got "+typeof e);return e}function Qa(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function tc(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}var Ks=(e,t)=>{function r(n,...o){if(yt(n),!Bh)throw new Error("Non little-endian hardware is not yet supported");if(e.nonceLength!==void 0){let l=o[0];if(!l)throw new Error("nonce / iv required");e.varSizeNonce?yt(l):yt(l,e.nonceLength)}let s=e.tagLength;s&&o[1]!==void 0&&yt(o[1]);let i=t(n,...o),a=(l,h)=>{if(h!==void 0){if(l!==2)throw new Error("cipher output not supported");yt(h)}},c=!1;return{encrypt(l,h){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,yt(l),a(i.encrypt.length,h),i.encrypt(l,h)},decrypt(l,h){if(yt(l),s&&l.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(i.decrypt.length,h),i.decrypt(l,h)}}}return Object.assign(r,e),r};function Ts(e,t,r=!0){if(t===void 0)return new Uint8Array(e);if(t.length!==e)throw new Error("invalid output length, expected "+e+", got: "+t.length);if(r&&!Ih(t))throw new Error("invalid output, must be aligned");return t}function $a(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),a=Number(r&s),c=n?4:0,f=n?0:4;e.setUint32(t+c,i,n),e.setUint32(t+f,a,n)}function ec(e,t,r){Kn(r);let n=new Uint8Array(16),o=vh(n);return $a(o,0,BigInt(t),r),$a(o,8,BigInt(e),r),n}function Ih(e){return e.byteOffset%4===0}function Un(e){return Uint8Array.from(e)}var nc=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),Lh=nc("expand 16-byte k"),Kh=nc("expand 32-byte k"),Th=Wt(Lh),Ch=Wt(Kh);function N(e,t){return e<<t|e>>>32-t}function Cs(e){return e.byteOffset%4===0}var Dn=64,Uh=16,oc=2**32-1,rc=new Uint32Array;function Dh(e,t,r,n,o,s,i,a){let c=o.length,f=new Uint8Array(Dn),l=Wt(f),h=Cs(o)&&Cs(s),u=h?Wt(o):rc,p=h?Wt(s):rc;for(let d=0;d<c;i++){if(e(t,r,n,l,i,a),i>=oc)throw new Error("arx: counter overflow");let w=Math.min(Dn,c-d);if(h&&w===Dn){let g=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let b=0,B;b<Uh;b++)B=g+b,p[B]=u[B]^l[b];d+=Dn;continue}for(let g=0,b;g<w;g++)b=d+g,s[b]=o[b]^f[g];d+=w}}function Us(e,t){let{allowShortKeys:r,extendNonceFn:n,counterLength:o,counterRight:s,rounds:i}=Qa({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return Tn(o),Tn(i),Kn(s),Kn(r),(a,c,f,l,h=0)=>{yt(a),yt(c),yt(f);let u=f.length;if(l===void 0&&(l=new Uint8Array(u)),yt(l),Tn(h),h<0||h>=oc)throw new Error("arx: counter overflow");if(l.length<u)throw new Error(`arx: output (${l.length}) is shorter than data (${u})`);let p=[],d=a.length,w,g;if(d===32)p.push(w=Un(a)),g=Ch;else if(d===16&&r)w=new Uint8Array(32),w.set(a),w.set(a,16),g=Th,p.push(w);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);Cs(c)||p.push(c=Un(c));let b=Wt(w);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(g,b,Wt(c.subarray(0,16)),b),c=c.subarray(16)}let B=16-o;if(B!==c.length)throw new Error(`arx: nonce must be ${B} or 16 bytes`);if(B!==12){let U=new Uint8Array(12);U.set(c,s?0:12-c.length),c=U,p.push(c)}let E=Wt(c);return Dh(e,g,b,E,f,l,h,i),Jt(...p),l}}var ut=(e,t)=>e[t++]&255|(e[t++]&255)<<8,Ds=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=Cn(t),yt(t,32);let r=ut(t,0),n=ut(t,2),o=ut(t,4),s=ut(t,6),i=ut(t,8),a=ut(t,10),c=ut(t,12),f=ut(t,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let l=0;l<8;l++)this.pad[l]=ut(t,16+2*l)}process(t,r,n=!1){let o=n?0:2048,{h:s,r:i}=this,a=i[0],c=i[1],f=i[2],l=i[3],h=i[4],u=i[5],p=i[6],d=i[7],w=i[8],g=i[9],b=ut(t,r+0),B=ut(t,r+2),E=ut(t,r+4),U=ut(t,r+6),k=ut(t,r+8),O=ut(t,r+10),M=ut(t,r+12),P=ut(t,r+14),S=s[0]+(b&8191),K=s[1]+((b>>>13|B<<3)&8191),D=s[2]+((B>>>10|E<<6)&8191),T=s[3]+((E>>>7|U<<9)&8191),y=s[4]+((U>>>4|k<<12)&8191),m=s[5]+(k>>>1&8191),x=s[6]+((k>>>14|O<<2)&8191),v=s[7]+((O>>>11|M<<5)&8191),_=s[8]+((M>>>8|P<<8)&8191),L=s[9]+(P>>>5|o),A=0,I=A+S*a+K*(5*g)+D*(5*w)+T*(5*d)+y*(5*p);A=I>>>13,I&=8191,I+=m*(5*u)+x*(5*h)+v*(5*l)+_*(5*f)+L*(5*c),A+=I>>>13,I&=8191;let C=A+S*c+K*a+D*(5*g)+T*(5*w)+y*(5*d);A=C>>>13,C&=8191,C+=m*(5*p)+x*(5*u)+v*(5*h)+_*(5*l)+L*(5*f),A+=C>>>13,C&=8191;let R=A+S*f+K*c+D*a+T*(5*g)+y*(5*w);A=R>>>13,R&=8191,R+=m*(5*d)+x*(5*p)+v*(5*u)+_*(5*h)+L*(5*l),A+=R>>>13,R&=8191;let q=A+S*l+K*f+D*c+T*a+y*(5*g);A=q>>>13,q&=8191,q+=m*(5*w)+x*(5*d)+v*(5*p)+_*(5*u)+L*(5*h),A+=q>>>13,q&=8191;let V=A+S*h+K*l+D*f+T*c+y*a;A=V>>>13,V&=8191,V+=m*(5*g)+x*(5*w)+v*(5*d)+_*(5*p)+L*(5*u),A+=V>>>13,V&=8191;let H=A+S*u+K*h+D*l+T*f+y*c;A=H>>>13,H&=8191,H+=m*a+x*(5*g)+v*(5*w)+_*(5*d)+L*(5*p),A+=H>>>13,H&=8191;let G=A+S*p+K*u+D*h+T*l+y*f;A=G>>>13,G&=8191,G+=m*c+x*a+v*(5*g)+_*(5*w)+L*(5*d),A+=G>>>13,G&=8191;let Z=A+S*d+K*p+D*u+T*h+y*l;A=Z>>>13,Z&=8191,Z+=m*f+x*c+v*a+_*(5*g)+L*(5*w),A+=Z>>>13,Z&=8191;let Q=A+S*w+K*d+D*p+T*u+y*h;A=Q>>>13,Q&=8191,Q+=m*l+x*f+v*c+_*a+L*(5*g),A+=Q>>>13,Q&=8191;let F=A+S*g+K*w+D*d+T*p+y*u;A=F>>>13,F&=8191,F+=m*h+x*l+v*f+_*c+L*a,A+=F>>>13,F&=8191,A=(A<<2)+A|0,A=A+I|0,I=A&8191,A=A>>>13,C+=A,s[0]=I,s[1]=C,s[2]=R,s[3]=q,s[4]=V,s[5]=H,s[6]=G,s[7]=Z,s[8]=Q,s[9]=F}finalize(){let{h:t,pad:r}=this,n=new Uint16Array(10),o=t[1]>>>13;t[1]&=8191;for(let a=2;a<10;a++)t[a]+=o,o=t[a]>>>13,t[a]&=8191;t[0]+=o*5,o=t[0]>>>13,t[0]&=8191,t[1]+=o,o=t[1]>>>13,t[1]&=8191,t[2]+=o,n[0]=t[0]+5,o=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=t[a]+o,o=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(o^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)t[a]=t[a]&s|n[a];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let i=t[0]+r[0];t[0]=i&65535;for(let a=1;a<8;a++)i=(t[a]+r[a]|0)+(i>>>16)|0,t[a]=i&65535;Jt(n)}update(t){Ls(this),t=Cn(t),yt(t);let{buffer:r,blockLen:n}=this,o=t.length;for(let s=0;s<o;){let i=Math.min(n-this.pos,o-s);if(i===n){for(;n<=o-s;s+=n)this.process(t,s);continue}r.set(t.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Jt(this.h,this.r,this.buffer,this.pad)}digestInto(t){Ls(this),Ja(t,this),this.finished=!0;let{buffer:r,h:n}=this,{pos:o}=this;if(o){for(r[o++]=1;o<16;o++)r[o]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)t[s++]=n[i]>>>0,t[s++]=n[i]>>>8;return t}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}};function Rh(e){let t=(n,o)=>e(o).update(Cn(n)).digest(),r=e(new Uint8Array(32));return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=n=>e(n),t}var sc=Rh(e=>new Ds(e));function cc(e,t,r,n,o,s=20){let i=e[0],a=e[1],c=e[2],f=e[3],l=t[0],h=t[1],u=t[2],p=t[3],d=t[4],w=t[5],g=t[6],b=t[7],B=o,E=r[0],U=r[1],k=r[2],O=i,M=a,P=c,S=f,K=l,D=h,T=u,y=p,m=d,x=w,v=g,_=b,L=B,A=E,I=U,C=k;for(let q=0;q<s;q+=2)O=O+K|0,L=N(L^O,16),m=m+L|0,K=N(K^m,12),O=O+K|0,L=N(L^O,8),m=m+L|0,K=N(K^m,7),M=M+D|0,A=N(A^M,16),x=x+A|0,D=N(D^x,12),M=M+D|0,A=N(A^M,8),x=x+A|0,D=N(D^x,7),P=P+T|0,I=N(I^P,16),v=v+I|0,T=N(T^v,12),P=P+T|0,I=N(I^P,8),v=v+I|0,T=N(T^v,7),S=S+y|0,C=N(C^S,16),_=_+C|0,y=N(y^_,12),S=S+y|0,C=N(C^S,8),_=_+C|0,y=N(y^_,7),O=O+D|0,C=N(C^O,16),v=v+C|0,D=N(D^v,12),O=O+D|0,C=N(C^O,8),v=v+C|0,D=N(D^v,7),M=M+T|0,L=N(L^M,16),_=_+L|0,T=N(T^_,12),M=M+T|0,L=N(L^M,8),_=_+L|0,T=N(T^_,7),P=P+y|0,A=N(A^P,16),m=m+A|0,y=N(y^m,12),P=P+y|0,A=N(A^P,8),m=m+A|0,y=N(y^m,7),S=S+K|0,I=N(I^S,16),x=x+I|0,K=N(K^x,12),S=S+K|0,I=N(I^S,8),x=x+I|0,K=N(K^x,7);let R=0;n[R++]=i+O|0,n[R++]=a+M|0,n[R++]=c+P|0,n[R++]=f+S|0,n[R++]=l+K|0,n[R++]=h+D|0,n[R++]=u+T|0,n[R++]=p+y|0,n[R++]=d+m|0,n[R++]=w+x|0,n[R++]=g+v|0,n[R++]=b+_|0,n[R++]=B+L|0,n[R++]=E+A|0,n[R++]=U+I|0,n[R++]=k+C|0}function Ph(e,t,r,n){let o=e[0],s=e[1],i=e[2],a=e[3],c=t[0],f=t[1],l=t[2],h=t[3],u=t[4],p=t[5],d=t[6],w=t[7],g=r[0],b=r[1],B=r[2],E=r[3];for(let k=0;k<20;k+=2)o=o+c|0,g=N(g^o,16),u=u+g|0,c=N(c^u,12),o=o+c|0,g=N(g^o,8),u=u+g|0,c=N(c^u,7),s=s+f|0,b=N(b^s,16),p=p+b|0,f=N(f^p,12),s=s+f|0,b=N(b^s,8),p=p+b|0,f=N(f^p,7),i=i+l|0,B=N(B^i,16),d=d+B|0,l=N(l^d,12),i=i+l|0,B=N(B^i,8),d=d+B|0,l=N(l^d,7),a=a+h|0,E=N(E^a,16),w=w+E|0,h=N(h^w,12),a=a+h|0,E=N(E^a,8),w=w+E|0,h=N(h^w,7),o=o+f|0,E=N(E^o,16),d=d+E|0,f=N(f^d,12),o=o+f|0,E=N(E^o,8),d=d+E|0,f=N(f^d,7),s=s+l|0,g=N(g^s,16),w=w+g|0,l=N(l^w,12),s=s+l|0,g=N(g^s,8),w=w+g|0,l=N(l^w,7),i=i+h|0,b=N(b^i,16),u=u+b|0,h=N(h^u,12),i=i+h|0,b=N(b^i,8),u=u+b|0,h=N(h^u,7),a=a+c|0,B=N(B^a,16),p=p+B|0,c=N(c^p,12),a=a+c|0,B=N(B^a,8),p=p+B|0,c=N(c^p,7);let U=0;n[U++]=o,n[U++]=s,n[U++]=i,n[U++]=a,n[U++]=g,n[U++]=b,n[U++]=B,n[U++]=E}var Nh=Us(cc,{counterRight:!1,counterLength:4,allowShortKeys:!1}),kh=Us(cc,{counterRight:!1,counterLength:8,extendNonceFn:Ph,allowShortKeys:!1});var Mh=new Uint8Array(16),ic=(e,t)=>{e.update(t);let r=t.length%16;r&&e.update(Mh.subarray(r))},Oh=new Uint8Array(32);function ac(e,t,r,n,o){let s=e(t,r,Oh),i=sc.create(s);o&&ic(i,o),ic(i,n);let a=ec(n.length,o?o.length:0,!0);i.update(a);let c=i.digest();return Jt(s,a),c}var fc=e=>(t,r,n)=>({encrypt(s,i){let a=s.length;i=Ts(a+16,i,!1),i.set(s);let c=i.subarray(0,-16);e(t,r,c,c,1);let f=ac(e,t,r,c,n);return i.set(f,a),Jt(f),i},decrypt(s,i){i=Ts(s.length-16,i,!1);let a=s.subarray(0,-16),c=s.subarray(-16),f=ac(e,t,r,a,n);if(!tc(c,f))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),e(t,r,i,i,1),Jt(f),i}}),Rs=Ks({blockSize:64,nonceLength:12,tagLength:16},fc(Nh)),pg=Ks({blockSize:64,nonceLength:24,tagLength:16},fc(kh));function hc(e,t,r){return ye(e),r===void 0&&(r=new Uint8Array(e.outputLen)),Ye(e,re(r),re(t))}var Ps=Uint8Array.from([0]),uc=Uint8Array.of();function lc(e,t,r,n=32){ye(e),pe(n);let o=e.outputLen;if(n>255*o)throw new Error("Length should be <= 255*HashLen");let s=Math.ceil(n/o);r===void 0&&(r=uc);let i=new Uint8Array(s*o),a=Ye.create(e,t),c=a._cloneInto(),f=new Uint8Array(a.outputLen);for(let l=0;l<s;l++)Ps[0]=l+1,c.update(l===0?uc:f).update(r).update(Ps).digestInto(f),i.set(f,o*l),a._cloneInto(c);return a.destroy(),c.destroy(),Lt(f,Ps),i.slice(0,n)}var Rn={hashSHA256(e){return he(e.subarray())},getHKDF(e,t){let r=hc(he,t,e),o=lc(he,r,void 0,96),s=o.subarray(0,32),i=o.subarray(32,64),a=o.subarray(64,96);return[s,i,a]},generateX25519KeyPair(){let e=Sr.utils.randomPrivateKey();return{publicKey:Sr.getPublicKey(e),privateKey:e}},generateX25519KeyPairFromSeed(e){return{publicKey:Sr.getPublicKey(e),privateKey:e}},generateX25519SharedKey(e,t){return Sr.getSharedSecret(e.subarray(),t.subarray())},chaCha20Poly1305Encrypt(e,t,r,n){return Rs(n,t,r).encrypt(e.subarray())},chaCha20Poly1305Decrypt(e,t,r,n,o){return Rs(n,t,r).decrypt(e.subarray(),o)}};var dc=Rn;function pc(e){return{generateKeypair:e.generateX25519KeyPair,dh:(t,r)=>e.generateX25519SharedKey(t.privateKey,r).subarray(0,32),encrypt:e.chaCha20Poly1305Encrypt,decrypt:e.chaCha20Poly1305Decrypt,hash:e.hashSHA256,hkdf:e.getHKDF}}var rr=e=>{let t=ot(2);return t[0]=e>>8,t[1]=e,t};rr.bytes=2;var Rr=e=>{if(e.length<2)throw RangeError("Could not decode int16BE");if(e instanceof Uint8Array){let t=0;return t+=e[0]<<8,t+=e[1],t}return e.getUint16(0)};Rr.bytes=2;function yc(e){return{xxHandshakeSuccesses:e.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:e.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:e.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:e.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:e.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function Ns(e,t){!t.enabled||!er||(e?(t(`LOCAL_STATIC_PUBLIC_KEY ${z(e.publicKey,"hex")}`),t(`LOCAL_STATIC_PRIVATE_KEY ${z(e.privateKey,"hex")}`)):t("Missing local static keys."))}function ks(e,t){!t.enabled||!er||(e?(t(`LOCAL_PUBLIC_EPHEMERAL_KEY ${z(e.publicKey,"hex")}`),t(`LOCAL_PRIVATE_EPHEMERAL_KEY ${z(e.privateKey,"hex")}`)):t("Missing local ephemeral keys."))}function mc(e,t){!t.enabled||!er||t(e?`REMOTE_STATIC_PUBLIC_KEY ${z(e.subarray(),"hex")}`:"Missing remote static public key.")}function Ms(e,t){!t.enabled||!er||t(e?`REMOTE_EPHEMERAL_PUBLIC_KEY ${z(e.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function Os(e,t,r){!r.enabled||!er||(r(`CIPHER_STATE_1 ${e.n.getUint64()} ${e.k&&z(e.k,"hex")}`),r(`CIPHER_STATE_2 ${t.n.getUint64()} ${t.k&&z(t.k,"hex")}`))}var nr=class e extends Error{code;constructor(t="Invalid crypto exchange"){super(t),this.code=e.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"};var Hh=0,qh=4294967295,Vh="Cipherstate has reached maximum n, a new handshake must be performed",Pn=class{n;bytes;view;constructor(t=Hh){this.n=t,this.bytes=nt(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,t,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>qh)throw new Error(Vh)}};var Ie=nt(0),or=class{k;n;crypto;constructor(t,r=void 0,n=0){this.crypto=t,this.k=r,this.n=new Pn(n)}hasKey(){return!!this.k}encryptWithAd(t,r){if(!this.hasKey())return r;this.n.assertValue();let n=this.crypto.encrypt(r,this.n.getBytes(),t,this.k);return this.n.increment(),n}decryptWithAd(t,r,n){if(!this.hasKey())return r;this.n.assertValue();let o=this.crypto.decrypt(r,this.n.getBytes(),t,this.k,n);return this.n.increment(),o}},Hs=class{cs;ck;h;crypto;constructor(t,r){this.crypto=t;let n=$(r,"utf-8");this.h=Gh(t,n),this.ck=this.h,this.cs=new or(t)}mixKey(t){let[r,n]=this.crypto.hkdf(this.ck,t);this.ck=r,this.cs=new or(this.crypto,n)}mixHash(t){this.h=this.crypto.hash(new X(this.h,t))}encryptAndHash(t){let r=this.cs.encryptWithAd(this.h,t);return this.mixHash(r),r}decryptAndHash(t){let r=this.cs.decryptWithAd(this.h,t);return this.mixHash(t),r}split(){let[t,r]=this.crypto.hkdf(this.ck,Ie);return[new or(this.crypto,t),new or(this.crypto,r)]}},qs=class{ss;s;e;rs;re;initiator;crypto;constructor(t){let{crypto:r,protocolName:n,prologue:o,initiator:s,s:i,e:a,rs:c,re:f}=t;this.crypto=r,this.ss=new Hs(r,n),this.ss.mixHash(o),this.initiator=s,this.s=i,this.e=a,this.rs=c,this.re=f}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");let t=this.crypto.generateKeypair();return this.ss.mixHash(t.publicKey),this.e=t,t.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(t,r=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(t.byteLength<r+32)throw new Error("message is not long enough");this.re=t.sublist(r,r+32),this.ss.mixHash(this.re)}readS(t,r=0){if(this.rs)throw new Error("remote static public key is already set");let n=32+(this.ss.cs.hasKey()?16:0);if(t.byteLength<r+n)throw new Error("message is not long enough");let o=t.sublist(r,r+n);return this.rs=this.ss.decryptAndHash(o),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}},Pr=class extends qs{writeMessageA(t){return new X(this.writeE(),this.ss.encryptAndHash(t))}writeMessageB(t){let r=this.writeE();this.writeEE();let n=this.writeS();return this.writeES(),new X(r,n,this.ss.encryptAndHash(t))}writeMessageC(t){let r=this.writeS();return this.writeSE(),new X(r,this.ss.encryptAndHash(t))}readMessageA(t){try{return this.readE(t),this.ss.decryptAndHash(t.sublist(32))}catch(r){throw new nr(`handshake stage 0 validation fail: ${r.message}`)}}readMessageB(t){try{this.readE(t),this.readEE();let r=this.readS(t,32);return this.readES(),this.ss.decryptAndHash(t.sublist(32+r))}catch(r){throw new nr(`handshake stage 1 validation fail: ${r.message}`)}}readMessageC(t){try{let r=this.readS(t);return this.readSE(),this.ss.decryptAndHash(t.sublist(r))}catch(r){throw new nr(`handshake stage 2 validation fail: ${r.message}`)}}};function Gh(e,t){if(t.length<=32){let r=nt(32);return r.set(t),r}else return e.hash(t)}var Nn;(function(e){let t;e.codec=()=>(t==null&&(t=Be((r,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),r.webtransportCerthashes!=null)for(let s of r.webtransportCerthashes)n.uint32(10),n.bytes(s);if(r.streamMuxers!=null)for(let s of r.streamMuxers)n.uint32(18),n.string(s);o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={webtransportCerthashes:[],streamMuxers:[]},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{if(o.limits?.webtransportCerthashes!=null&&s.webtransportCerthashes.length===o.limits.webtransportCerthashes)throw new _r('Decode error - map field "webtransportCerthashes" had too many elements');s.webtransportCerthashes.push(r.bytes());break}case 2:{if(o.limits?.streamMuxers!=null&&s.streamMuxers.length===o.limits.streamMuxers)throw new _r('Decode error - map field "streamMuxers" had too many elements');s.streamMuxers.push(r.string());break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>ve(r,e.codec()),e.decode=(r,n)=>Se(r,e.codec(),n)})(Nn||(Nn={}));var Nr;(function(e){let t;e.codec=()=>(t==null&&(t=Be((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.identityKey!=null&&r.identityKey.byteLength>0&&(n.uint32(10),n.bytes(r.identityKey)),r.identitySig!=null&&r.identitySig.byteLength>0&&(n.uint32(18),n.bytes(r.identitySig)),r.extensions!=null&&(n.uint32(34),Nn.codec().encode(r.extensions,n)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={identityKey:nt(0),identitySig:nt(0)},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.identityKey=r.bytes();break}case 2:{s.identitySig=r.bytes();break}case 4:{s.extensions=Nn.codec().decode(r,r.uint32(),{limits:o.limits?.extensions});break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>ve(r,e.codec()),e.decode=(r,n)=>Se(r,e.codec(),n)})(Nr||(Nr={}));async function Vs(e,t,r){let n=await e.sign(gc(t));return Nr.encode({identityKey:ee(e.publicKey),identitySig:n,extensions:r})}async function Gs(e,t,r){try{let n=Nr.decode(e),o=Kr(n.identityKey);if(r?.equals(o)===!1)throw new Error(`Payload identity key ${o} does not match expected remote identity key ${r}`);if(!t)throw new Error("Remote static does not exist");let s=gc(t);if(!await o.verify(s,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new Mr(n.message)}}function gc(e){let t=$("noise-libp2p-static-key:");return e instanceof Uint8Array?le([t,e],t.length+e.length):(e.prepend(t),e)}async function xc(e,t){let{log:r,connection:n,crypto:o,privateKey:s,prologue:i,s:a,remoteIdentityKey:c,extensions:f}=e,l=await Vs(s,a.publicKey,f),h=new Pr({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:i,s:a});Ns(h.s,r),r.trace("Stage 0 - Initiator starting to send first message."),await n.write(h.writeMessageA(Ie),t),r.trace("Stage 0 - Initiator finished sending first message."),ks(h.e,r),r.trace("Stage 1 - Initiator waiting to receive first message from responder...");let u=h.readMessageB(await n.read(t));r.trace("Stage 1 - Initiator received the message."),Ms(h.re,r),mc(h.rs,r),r.trace("Initiator going to check remote's signature...");let p=await Gs(u,h.rs,c);r.trace("All good with the signature!"),r.trace("Stage 2 - Initiator sending third handshake message."),await n.write(h.writeMessageC(l),t),r.trace("Stage 2 - Initiator sent message with signed payload.");let[d,w]=h.ss.split();return Os(d,w,r),{payload:p,encrypt:g=>d.encryptWithAd(Ie,g),decrypt:(g,b)=>w.decryptWithAd(Ie,g,b)}}async function bc(e,t){let{log:r,connection:n,crypto:o,privateKey:s,prologue:i,s:a,remoteIdentityKey:c,extensions:f}=e,l=await Vs(s,a.publicKey,f),h=new Pr({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:i,s:a});Ns(h.s,r),r.trace("Stage 0 - Responder waiting to receive first message."),h.readMessageA(await n.read(t)),r.trace("Stage 0 - Responder received first message."),Ms(h.re,r),r.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(h.writeMessageB(l),t),r.trace("Stage 1 - Responder sent the second handshake message with signed payload."),ks(h.e,r),r.trace("Stage 2 - Responder waiting for third handshake message...");let u=h.readMessageC(await n.read(t));r.trace("Stage 2 - Responder received the message, finished handshake.");let p=await Gs(u,h.rs,c),[d,w]=h.ss.split();return Os(d,w,r),{payload:p,encrypt:g=>w.encryptWithAd(Ie,g),decrypt:(g,b)=>d.decryptWithAd(Ie,g,b)}}var Ec=16;function Sc(e,t){return async function*(r){for await(let n of r)for(let o=0;o<n.length;o+=65519){let s=o+65519;s>n.length&&(s=n.length);let i;n instanceof Uint8Array?i=e.encrypt(n.subarray(o,s)):i=e.encrypt(n.sublist(o,s)),t?.encryptedPackets.increment(),yield new X(rr(i.byteLength),i)}}}function Ac(e,t){return async function*(r){for await(let n of r)for(let o=0;o<n.length;o+=65535){let s=o+65535;if(s>n.length&&(s=n.length),s-Ec<o)throw new Error("Invalid chunk");let i=n.sublist(o,s),a=n.subarray(o,s-Ec);try{let c=e.decrypt(i,a);t?.decryptedPackets.increment(),yield c}catch(c){throw t?.decryptErrors.increment(),c}}}}var kn=class{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;constructor(t,r={}){let{staticNoiseKey:n,extensions:o,crypto:s,prologueBytes:i}=r,{metrics:a}=t;this.components=t;let c=s??dc;this.crypto=pc(c),this.extensions={webtransportCerthashes:[],...o},this.metrics=a?yc(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=i??nt(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[js]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];async secureOutbound(t,r){let n=vs(t,{lengthEncoder:rr,lengthDecoder:Rr,maxDataLength:65535}),o=await this.performHandshakeInitiator(n,this.components.privateKey,r?.remotePeer?.publicKey,r),s=await this.createSecureConnection(n,o);t.source=s.source,t.sink=s.sink;let i=Kr(o.payload.identityKey);return{conn:t,remoteExtensions:o.payload.extensions,remotePeer:Es(i),streamMuxer:r?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(o.payload.extensions?.streamMuxers)}}getStreamMuxer(t){if(t==null||t.length===0)return;let r=this.components.upgrader.getStreamMuxers();if(r!=null)for(let n of t){let o=r.get(n);if(o!=null)return o}if(t.length)throw new Or("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(t,r){let n=vs(t,{lengthEncoder:rr,lengthDecoder:Rr,maxDataLength:65535}),o=await this.performHandshakeResponder(n,this.components.privateKey,r?.remotePeer?.publicKey,r),s=await this.createSecureConnection(n,o);t.source=s.source,t.sink=s.sink;let i=Kr(o.payload.identityKey);return{conn:t,remoteExtensions:o.payload.extensions,remotePeer:Es(i),streamMuxer:r?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(o.payload.extensions?.streamMuxers)}}async performHandshakeInitiator(t,r,n,o){let s,i=o?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{s=await xc({connection:t,privateKey:r,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:i,webtransportCerthashes:[],...this.extensions}},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(a){throw this.metrics?.xxHandshakeErrors.increment(),a}return s}async performHandshakeResponder(t,r,n,o){let s,i=o?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{s=await bc({connection:t,privateKey:r,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:i,webtransportCerthashes:[],...this.extensions}},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(a){throw this.metrics?.xxHandshakeErrors.increment(),a}return s}async createSecureConnection(t,r){let[n,o]=Fa(),s=t.unwrap();return await Za(n,Sc(r,this.metrics),s,i=>Ur(i,{lengthDecoder:Rr}),Ac(r,this.metrics),n),o}};function Fh(e={}){return t=>new kn(t,e)}return Lc(zh);})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/edwards.js:
@noble/curves/esm/abstract/montgomery.js:
@noble/curves/esm/ed25519.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/_shortw_utils.js:
@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
return ChainsafeLibp2PNoise}));
//# sourceMappingURL=index.min.js.map
